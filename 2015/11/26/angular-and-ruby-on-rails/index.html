<!DOCTYPE html>
<html>

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Angular 1.x and Ruby on Rails</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="I am writing here some toughts during my work in Ruby on Rails, Javascript and other">
      <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/assets/css/main.css">
      <link rel="stylesheet" href="/assets/css/toc.css">

  </head>

  <body>

    <header class="site-header">

      <div class="wrap">

        <a class="site-title" href="/">duleorlovic - web developer</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
               viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
              <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
                h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
                h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
                c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </a>
          <div class="trigger">
            
              <a class="page-link" href="/about/">About</a>
            
              
            
              
            
              
            
          </div>
        </nav>
        <small>tools like
          <a href=" 
            /2015/04/05/common-rails-bootstrap-snippets/"
            >Rails bootstrap</a>,
          <a href=" /2015/11/09/rails-testing/">Rails testing</a>
            and <a href=" 
            /2016/04/12/rails-tips/">Rails tips</a>
          are still in use so content can be updated!
          <a href="javascript:void(0)"
            onclick="document.getElementById('mc_embed_signup').classList.toggle('active');">Notify
          me</a>
        </small>
	  <!-- Begin MailChimp Signup Form -->
	  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
	  <style type="text/css">
		  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
		  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
		     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
	  </style>
	  <div id="mc_embed_signup" class="signup-form">
	    <form action="//trk.us14.list-manage.com/subscribe/post?u=819590ae53cb08bddb952ed97&amp;id=ec1213024d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<div id="mc_embed_signup_scroll">
	    <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
	    <div class="mc-field-group">
		    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
	    </label>
		    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	    </div>
		    <div id="mce-responses" class="clear">
			    <div class="response" id="mce-error-response" style="display:none"></div>
			    <div class="response" id="mce-success-response" style="display:none"></div>
		    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_819590ae53cb08bddb952ed97_ec1213024d" tabindex="-1" value=""></div>
		<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
		</div>
	    </form>
	  </div>
	  <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
	  <!--End mc_embed_signup-->

      </div>
    <!-- Html Elements for Search -->
    <div id="search-demo-container">
    <input type="text" id="search-input" placeholder="search...">
    <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to jekyll-search.js -->
    <script src="/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json',
      });
    </script>

    </header>
    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Angular 1.x and Ruby on Rails</h1>
    <p class="meta">Nov 26, 2015</p>
  </header>

  <article class="post-content">
  <body><div id="toc-container"><table class="toc" id="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div><ul><li class="toc_level-1 toc_section-1"><a href="#rails-as-asset-pipeline"><span class="tocnumber">1</span> <span class="toctext">Rails as asset pipeline</span></a></li><li class="toc_level-1 toc_section-2"><a href="#railsresourcefactory"><span class="tocnumber">2</span> <span class="toctext">railsResourceFactory</span></a></li><li class="toc_level-1 toc_section-3"><a href="#example-apps-for-angular-rails"><span class="tocnumber">3</span> <span class="toctext">Example apps for Angular Rails:</span></a><ul><li class="toc_level-2 toc_section-4"><a href="#angular-inside-rails-asset-pipeline"><span class="tocnumber">3.1</span> <span class="toctext">Angular inside rails asset pipeline</span></a></li><li class="toc_level-2 toc_section-5"><a href="#angular-and-rails-totally-separated-using-gulp"><span class="tocnumber">3.2</span> <span class="toctext">Angular and Rails totally separated using gulp</span></a></li></ul></li><li class="toc_level-1 toc_section-6"><a href="#angular-httpprovider-cant-send-json-patch-request"><span class="tocnumber">4</span> <span class="toctext">Angular httpProvider can’t send json patch request</span></a></li></ul></td></tr></tbody></table></div><h1 id="rails-as-asset-pipeline">Rails as asset pipeline</h1>

<p>I like to have Rails doing all javascript assets so I choose
<a href="https://github.com/pitr/angular-rails-templates">angular-rails-templates</a> to
cache all templates and <a href="https://github.com/rharriso/bower-rails">bower-rails</a>
gem to install all scripts under vendor folder (nice
<a href="http://angular-rails.com/bootstrap.html">tutorial</a>). When angular requests
templates, it needs url of that file. Since rails uses asset pipeline we need to
use erb <code class="highlighter-rouge">templateUrl: '&lt;%= asset_path 'template' %&gt;'</code> (when we store assets on
CDN, than we need to allow CORS since angular is loaded on our domain). Other
solution is
<a href="https://github.com/pitr/angular-rails-templates">angular-rails-templates</a> gem
which create angular cache for all templates that found in
<code class="highlighter-rouge">app/assets/javascript/templates</code> (if you want to place templates outside of
that folder watch this
<a href="https://github.com/pitr/angular-rails-templates/issues/107">issue</a>). Keep in
mind that you need latest gem version (1.4 does not work).</p>

<p>Since rails use minification, we need to write angular dependency inject
arguments inside ‘’ like <code class="highlighter-rouge">'$scope'</code> so they survive minification that happens to
javascript. Those arguments are all except last one which is a function in
<code class="highlighter-rouge">app.controller("MyController",['$scope',...,myController])</code></p>

<p>It is easier to follow callstack if we don’t use anonymous function. On other
hand it’s difficult to keep sync injection params with actual definition params,
so I use <a href="https://github.com/kikonen/ngannotate-rails">ng-annotate</a>.</p>

<h1 id="railsresourcefactory">railsResourceFactory</h1>

<p>There is a angular factory for resource
<a href="https://github.com/FineLinePrototyping/angularjs-rails-resource">angularjs-rails-resource</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bower install angularjs-rails-resource --save
# resolve with latest angular, it works find with 1.5.3
</code></pre></div></div>

<p>You can start from <a href="https://github.com/FineLinePrototyping/angularjs-rails-resource/blob/master/EXAMPLES.md">EXAMPLES</a> and search applications for it’s usage
<a href="https://github.com/search?q=saveIndicatorInterceptor&amp;type=Code&amp;utf8=%E2%9C%93">saveIndicatorInterceptor</a></p>

<p>Here is simple example for ionic</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># www/js/app.js
angular.module 'starter', ['ionic', 'rails']

# www/index.html
    &lt;!-- Rails Resource
    https://github.com/FineLinePrototyping/angularjs-rails-resource --&gt;
    &lt;script src="lib/angularjs-rails-resource/angularjs-rails-resource.min.js"&gt;&lt;/script&gt;

# www/js/resources/locationTiken.resource.coffee
angular.module 'starter'
  .factory 'LocationTicket', (railsResourceFactory, CONSTANT) -&gt;
    railsResourceFactory
      url: CONSTANT.SERVER_URL + '/location_tickets'
      name: 'location_ticket'

# www/js/locationTicke/locationTicket.controller.coffee
</code></pre></div></div>

<p>Note that
<a href="https://github.com/FineLinePrototyping/angularjs-rails-resource#resource-urls">resource-url</a>
could be a function that will be evaluated at runtime (usefull if you need to
change api url depending on which user is logged in).  You can set context with</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Item.query({category: 'Software'}, {storeId: 123}) // would generate a GET to /stores/123/items?category=Software
Item.get({storeId: 123, id: 1}) // would generate a GET to /stores/123/items/1
</code></pre></div></div>

<p>I use that context to change url for my custom methods.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># some controller
LocationTicket.query({}, info: true).then (info) -&gt;
  vm.info = info

# www/js/resources/locationTicket.resource.coffee
angular.module 'starter'
  .factory 'LocationTicket', (railsResourceFactory, CustomerAuth) -&gt;
    railsResourceFactory
      url: (context) -&gt;
        if context &amp;&amp; context.id
          CustomerAuth.locationServerUrl + '/api/v1/location_tickets/' +
          context.id
        else if context.info
          CustomerAuth.locationServerUrl + '/api/v1/location_tickets/info'
        else
          CustomerAuth.locationServerUrl + '/api/v1/location_tickets'
      name: 'location_ticket'
</code></pre></div></div>

<p>I use interceptor for loader. Also show toast if flag is set like
<code class="highlighter-rouge">cart.showToastOnError = true; cart.delete()</code>. For some resource I show toast
for all errors by adding <code class="highlighter-rouge">interceptors: [notifyInterceptor]</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># src/app/resource/myResourceFactory.interceptor.coffee
angular.module 'myapp.resources'
  # https://github.com/FineLinePrototyping/angularjs-rails-resource/blob/master/vendor/assets/javascripts/angularjs/rails/resource/resource.js#L860
  .factory 'myResourceFactory', (RailsResource, saveIndicatorInterceptor) -&gt;
    (config) -&gt;
      Resource = () -&gt;
        Resource.__super__.constructor.apply(this, arguments)
        return
      RailsResource.extendTo Resource
      config["interceptors"] ||= []
      config["interceptors"].push saveIndicatorInterceptor
      Resource.configure config
      Resource
  .factory 'saveIndicatorInterceptor', ($rootScope, $q, toastr) -&gt;
    beforeRequest: (httpConfig, resourceConstructor, context) -&gt;
      $rootScope.isLoading = true
      httpConfig
    afterResponse: (result, resourceConstructor, context) -&gt;
      $rootScope.isLoading = false
      result
    afterResponseError: (rejection, resourceConstructor, context) -&gt;
      $rootScope.isLoading = false
      if context.showToastOnError
        if rejection.data.error
          message = rejection.data.error
        else
          message = JSON.stringify rejection.data
        toastr.error message
      $q.reject rejection
  # https://github.com/FineLinePrototyping/angularjs-rails-resource#example-interceptor
  .factory 'notifyInterceptor', (toastr, $q) -&gt;
    afterResponseError: (rejection, resourceConstructor, context) -&gt;
      message = JSON.stringify rejection.data
      toastr.error message
      $q.reject rejection
</code></pre></div></div>

<p>So I use <code class="highlighter-rouge">myResourceFactory</code> as base for all my resources.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>angular.module 'myapp.resources'
  .factory 'Restaurant', (myResourceFactory, railsSerializer, CONFIG) -&gt;
    myResourceFactory
      url: (context) -&gt;
        # https://github.com/FineLinePrototyping/angularjs-rails-resource/issues/141
        # https://github.com/FineLinePrototyping/angularjs-rails-resource#resource-urls
        if context &amp;&amp; context.id
          CONFIG.API_URL + '/restaurants/'+context.id
        else if context &amp;&amp; context.userId
          CONFIG.API_URL + '/users/'+context.userId+'/restaurants'
        else if context &amp;&amp; context.link
          CONFIG.API_URL + '/restaurants/'+context.link+'/by-link'
        else
          CONFIG.API_URL + '/restaurants'
      name: 'restaurant'
      serializer: railsSerializer( -&gt;
        this.resource 'menuSections', 'MenuSection'
      )
      interceptors: [notifyInterceptor]
</code></pre></div></div>

<p>If you need to add property to resorce object (to have custom url) you should
use finally to clean up that resource for later <code class="highlighter-rouge">.save()</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    vm.signInAs = (user) -&gt;
      user.signInAs = true
      user.save().then (resp) -&gt;
        toastr.info "Authenticated as #{user.firstName}. Please refresh"
      .finally -&gt;
        user.signInAs = false
</code></pre></div></div>

<p><a href="https://github.com/FineLinePrototyping/angularjs-rails-resource/blob/master/EXAMPLES.md#adding-custom-methods-to-a-resource">Adding custom
methods</a></p>

<h1 id="example-apps-for-angular-rails">Example apps for Angular Rails:</h1>

<p>Tutorial videos (first are free) <a href="https://egghead.io/technologies/angularjs?order=ASC">egghead</a></p>

<ul>
  <li><a href="https://github.com/jesalg/RADD">RADD</a>: custom session with devise, api docs
are generated
<a href="https://github.com/zipmark/rspec_api_documentation">rspec_api_documentation</a></li>
  <li><a href="https://github.com/duleorlovic/flapper-news">flapper-news</a>
<a href="https://thinkster.io/angular-rails">thinkster</a>
<a href="https://github.com/cloudspace/angular_devise">angular-devise</a></li>
  <li><a href="https://github.com/jasonswett/lunch_hub">lunch_hub</a>
<a href="https://www.airpair.com/ruby-on-rails/posts/authentication-with-angularjs-and-ruby-on-rails">post</a>
<a href="https://github.com/lynndylanhurley/ng-token-auth">ng-token-auth</a>, grunt</li>
  <li><a href="https://github.com/mkwiatkowski/todo-rails4-angularjs">todo-rails4-angularjs</a>
<a href="https://shellycloud.com/blog/2013/10/how-to-integrate-angularjs-with-rails-4">shellycloud</a>
turbolinks, html auth</li>
  <li><a href="https://github.com/davetron5000/receta">receta</a>
<a href="http://angular-rails.com/">angular-rails</a> CRUD (no auth), TDD, angular-flash</li>
  <li><a href="https://github.com/lynndylanhurley/ng-token-auth">ng-token-auth</a>
<a href="https://github.com/lynndylanhurley/devise_token_auth_demo">devise-token-auth-demo</a>
devise-token-auth <code class="highlighter-rouge">cd ng-token-auth/test &amp;&amp; bower install</code> update
<code class="highlighter-rouge">config/default.yml</code> so <code class="highlighter-rouge">API_URL='//devise-token-auth-demo.local:3000'</code> and run
<code class="highlighter-rouge">gulp dev</code> and go to <a href="http://localhost:7777">localhost:7777</a>. In another
window <code class="highlighter-rouge">cd devise_token_auth_demo &amp;&amp; bundle &amp;&amp; rails s</code>.
<a href="https://github.com/search?utf8=%E2%9C%93&amp;q=ng-token-auth&amp;type=Code&amp;ref=searchresults">ng-token-auth</a>
is used ~2.5K times. On server use gem
<a href="https://github.com/lynndylanhurley/devise_token_auth">devise_token_auth</a>, run
application with <code class="highlighter-rouge">gulp dev</code> and run <a href="https://github.com/lynndylanhurley/devise_token_auth_demo.git">demo
server</a>.</li>
  <li><a href="https://www.angularonrails.com/ruby-on-rails-angularjs-single-page-application/">angularonrails.com</a></li>
  <li>
    <p><a href="https://web.telegram.org/#/login">telegram.org</a> encrypted json</p>
  </li>
  <li>
    <p>for start from scratch using ng-token-auth look at</p>

    <p><a href="/2015/12/20/devise-oauth-angular/">devise-oauth-angular</a></p>
  </li>
</ul>

<h2 id="angular-inside-rails-asset-pipeline">Angular inside rails asset pipeline</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo '
# js package manager
gem "bower-rails"
# cache all templates
gem "angular-rails-templates"
' &gt;&gt; Gemfile
bundle
rails g bower_rails:initialize
git add . &amp;&amp; git commit -m "rails g bower_rails:initialize"

echo '
Rails.application.config.assets.paths &lt;&lt; Rails.root.join("vendor","assets","bower_components")
Rails.application.config.assets.paths &lt;&lt; Rails.root.join("vendor","assets","bower_components","bootstrap-sass-official","assets","fonts")
Rails.application.config.assets.precompile &lt;&lt; %r(.*.(?:eot|svg|ttf|woff|woff2)$)
' &gt;&gt; config/initializers/bower_rails.rb

echo '
asset "angular"
asset "bootstrap-sass-official"
# vim: ft-ruby
' &gt;&gt; Bowerfile

rake bower:install

git rm app/assets/stylesheets/application.css
echo '
@import "bootstrap-sass-official/assets/stylesheets/bootstrap-sprockets";
@import "bootstrap-sass-official/assets/stylesheets/bootstrap";
' &gt;&gt; app/assets/stylesheets/application.scss

sed -i '/jquery_ujs/a \
//= require angular/angular' app/assets/javascripts/application.js

git add . &amp;&amp; git commit -am "rake bower:install angular &amp; boostrap"
</code></pre></div></div>

<h2 id="angular-and-rails-totally-separated-using-gulp">Angular and Rails totally separated using gulp</h2>

<p>Asset pipeline using gulp.
Good reference is <a href="https://github.com/grantgeorge/railsAngularTutorial">railsAngularTutorial</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># first create rails server side
rails new --database=postgresql air
cd air
git init &amp;&amp; git add . &amp;&amp; git commit -m "rails new air  --database=postgresql"

rails g scaffold articles title:string body:text
rake db:migrate
git add . &amp;&amp; git commit -m "rails g scaffold articles title:string body:text"
echo "Article.create(title: 'Test Article', body: 'A test article. Cool')" &gt;&gt; db/seeds.rb
rake db:seed
mkdir app/controllers/v1
git mv app/controllers/articles_controller.rb app/controllers/v1/articles_controller.rb
sed -i "/articles/c \\\n\
  scope '/api' do\n\
    namespace :v1, defaults: { format: :json } do\n\
      resources :articles, except: [:new, :edit]\n\
    end\n\
  end\n\
" config/routes.rb
sed -i '/class ArticlesController/c class V1::ArticlesController &lt; ApplicationController' app/controllers/v1/articles_controller.rb
mkdir app/views/v1
git mv app/views/articles/ app/views/v1/
sed -i '/article_url/c \  json.url v1_article_url(article, format: :json)' app/views/v1/articles/index.json.jbuilder
git add . &amp;&amp; git commit -m "Move Articles to api/v1 namespace"

echo "gem 'rails_12factor', group: :production" &gt;&gt; Gemfile
bundle install
git add . &amp;&amp; git commit -m "Heroku uses 12 factor"
heroku create
heroku addons:create heroku-postgresql:hobby-dev
git push heroku master --set-upstream
heroku run rake db:migrate db:seed
heroku open api/v1/articles
</code></pre></div></div>

<p>Yeoman yo <a href="https://github.com/Swiip/generator-gulp-angular">gulp-angular</a> is great since it provides some initial tools.
I use <code class="highlighter-rouge">$log</code> for logging objects, for example <code class="highlighter-rouge">$log.debug loginController: 'submitLogin then', resp: resp</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># than creating angular client side
npm install -g yo generator-gulp-angular
mkdir client &amp;&amp; cd $_
yo gulp-angular myappAngular # don't --default
# choose coffe cript and Angular material
git add . &amp;&amp; git commit -m "yo gulp-angular with coffeescript and Material"
# config proxy for /api and /omniauth, add params -p and -o
sed -i gulp/server.js -f - &lt;&lt;HERE_DOC
/function browserSyncInit(baseDir, browser) {/c \
function browserSyncInit(baseDir, browser, port, open, livereload) {\n\
  port = port === undefined ? '3000' : port;\n\
  open = open === undefined ? false : open;\n\
  var snippetOptions = livereload === true ? {} : { rule: { match: /xxx/ } };

/routes: routes/i \    middleware: [\n\
      proxyMiddleware(["/api","/omniauth"], { target: "http://localhost:"+port }),\n\
    ],
/browserSync.instance/a \\
    port: 9000,\n\
    ui: {\n\
      port: 8080,\n\
    },\n\
    open: open,\n\
    snippetOptions: snippetOptions,
s/task('serve'/task('serve_original'/
HERE_DOC
cat &gt;&gt; gulp/server.js &lt;&lt;'HERE_DOC'
gulp.task('serve', ['watch'], function () {
  // http://stackoverflow.com/questions/28538918/pass-parameter-to-gulp-task
  var port, open, livereload, i;
  i = process.argv.indexOf("-p");
  if (i&gt;-1) {
    port = process.argv[i+1];
    console.log("Find parameter -p " + port);
  }
  i = process.argv.indexOf("-o");
  if (i&gt;-1) {
    open = true;
    console.log("Find parameter -o");
  }
  i = process.argv.indexOf("-l");
  if (i&gt;-1) {
    livereload = true;
    console.log("Find parameter -l");
  }
  browserSyncInit([path.join(conf.paths.tmp, '/serve'), conf.paths.src], undefined, port, open, livereload);
});
HERE_DOC
git add . &amp;&amp; git commit -m "Config middleware to 3000 or -p param"

# better formating
sed -i src/app/index.module.coffee \
  -e 's/, /,\n  /g' \
  -e 's/  \[/\[\n  /g' \
  -e 's/\]/,\n\]/'

# use latest angular material
sed -i bower.json -e '/angular-material/c\
    "angular-material": "*",'
bower update angular-material --save
</code></pre></div></div>

<p>Example articles factory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir src/app/components/articles
cat &gt; src/app/components/articles/article.factory.js &lt;&lt; \EOF
'use strict';

angular.module('myappAngular')
  .factory('Article', function ($resource) {
    return $resource('api/v1/articles/:articleId', {
      articleId: '@id'
    }, {
      update: {
        method: 'PUT'
      }
    });
  });
EOF

echo note that this works for javascript not for coffeescript
sed -i '/vm.showToastr/a \
    Article.query(function (res) {\
      vm.articles = res;\
    });' src/app/main/main.controller.js
sed -i '/function MainController/c \  function MainController($timeout, webDevTec, toastr, Article) {' src/app/main/main.controller.js
sed -i '/Allo/c \
    &lt;h1&gt;Articles&lt;/h1&gt;\
    &lt;div ng-repeat="article in main.articles"&gt;\
      &lt;h2&gt;{{ article.title }}&lt;/h2&gt;\
      &lt;p&gt;{{ article.body }}&lt;/p&gt;\
    &lt;/div&gt;\
' src/app/main/main.html
cd .. # back to root
git add . &amp;&amp; git commit -m "Adding angular Article resource and show on main page"
</code></pre></div></div>

<p>To run on linux/windows, install git (Use Git from the Windows Command Prompt)
and nodejs.  Run in windows command line cmd: <code class="highlighter-rouge">npm install -g gulp</code> and <code class="highlighter-rouge">npm
install</code> and <code class="highlighter-rouge">gulp serve</code></p>

<p>If you want to completely split front end code, than use some <a href="/2016/03/02/gulp-tasks/">Gulp tasks</a></p>

<h1 id="angular-httpprovider-cant-send-json-patch-request">Angular httpProvider can’t send json patch request</h1>

<p>Can’t set <code class="highlighter-rouge">'Content-Type': 'application/json'</code> for angular <code class="highlighter-rouge">$http(method:
'PATCH')</code>. I tried with both inline <code class="highlighter-rouge">header</code> and config
<code class="highlighter-rouge">$httpProvider.defaults.headers.patch = 'Content-Type': 'application/json'</code>but
not luck. It is always http request.</p>

<p>UPDATE: it can send, but url needs to be <code class="highlighter-rouge">.json</code>
Do not use <code class="highlighter-rouge">patch</code> because old browsers (if you use ionic, that means old
phones).</p>
</body>
  </article>

  
  
  
  
    
  
  
  
  
  
  
  
  

</div>

      </div>
    </div>

    <style type='text/css'>
      .similar-links {
        display: inline-block;
        padding: 10px;
      }
    </style>
    <footer class="site-footer">

      <div class="wrap">

        <h2 class="footer-heading">duleorlovic - web developer</h2>

        <div class="footer-col-1 column">
          <ul>
            <li><a href="http://duleorlovic.github.io/tips/">short indistinct tips</a></li>
          </ul>
        </div>

        <div class="footer-col-2 column">
          <ul>
            <li>
              <a href="https://github.com/duleorlovic">
                <span class="icon github">
                  <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                    c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                    c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                    c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                    C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                    c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                    c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                    c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                    c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                  </svg>
                </span>
                <span class="username">duleorlovic</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="footer-col-3 column">
          <p class="text">I am writing here some toughts during my work in Ruby on Rails, Javascript and other</p>
        </div>

      </div>

    </footer>

  </body>
</html>
