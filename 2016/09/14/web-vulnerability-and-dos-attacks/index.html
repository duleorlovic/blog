<!DOCTYPE html>
<html>

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Web Vulnerability And Dos Attacks</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="I am writing here some toughts during my work in Ruby on Rails, Javascript and other">
      <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/assets/css/main.css">
      <link rel="stylesheet" href="/assets/css/toc.css">

  </head>

  <body>

    <header class="site-header">

      <div class="wrap">

        <a class="site-title" href="/">duleorlovic - web developer</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
               viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
              <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
                h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
                h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
                c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </a>
          <div class="trigger">
            
              <a class="page-link" href="/about/">About</a>
            
              
            
              
            
              
            
          </div>
        </nav>
        <small>tools like
          <a href=" 
            /2015/04/05/common-rails-bootstrap-snippets/"
            >Rails bootstrap</a>,
          <a href=" /2015/11/09/rails-testing/">Rails testing</a>
            and <a href=" 
            /2016/04/12/rails-tips/">Rails tips</a>
          are still in use so content can be updated!
          <a href="javascript:void(0)"
            onclick="document.getElementById('mc_embed_signup').classList.toggle('active');">Notify
          me</a>
        </small>
	  <!-- Begin MailChimp Signup Form -->
	  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
	  <style type="text/css">
		  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
		  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
		     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
	  </style>
	  <div id="mc_embed_signup" class="signup-form">
	    <form action="//trk.us14.list-manage.com/subscribe/post?u=819590ae53cb08bddb952ed97&amp;id=ec1213024d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<div id="mc_embed_signup_scroll">
	    <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
	    <div class="mc-field-group">
		    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
	    </label>
		    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	    </div>
		    <div id="mce-responses" class="clear">
			    <div class="response" id="mce-error-response" style="display:none"></div>
			    <div class="response" id="mce-success-response" style="display:none"></div>
		    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_819590ae53cb08bddb952ed97_ec1213024d" tabindex="-1" value=""></div>
		<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
		</div>
	    </form>
	  </div>
	  <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
	  <!--End mc_embed_signup-->

      </div>
    <!-- Html Elements for Search -->
    <div id="search-demo-container">
    <input type="text" id="search-input" placeholder="search...">
    <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to jekyll-search.js -->
    <script src="/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json',
      });
    </script>

    </header>
    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Web Vulnerability And Dos Attacks</h1>
    <p class="meta">Sep 14, 2016</p>
  </header>

  <article class="post-content">
  <body><div id="toc-container"><table class="toc" id="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div><ul><li class="toc_level-1 toc_section-1"><a href="#dos-attack"><span class="tocnumber">1</span> <span class="toctext">DOS attack</span></a><ul><li class="toc_level-2 toc_section-2"><a href="#siege"><span class="tocnumber">1.1</span> <span class="toctext">Siege</span></a></li><li class="toc_level-2 toc_section-3"><a href="#ab"><span class="tocnumber">1.2</span> <span class="toctext">AB</span></a></li></ul></li><li class="toc_level-1 toc_section-4"><a href="#rack-attack"><span class="tocnumber">2</span> <span class="toctext">Rack Attack</span></a></li><li class="toc_level-1 toc_section-5"><a href="#rack-timeout"><span class="tocnumber">3</span> <span class="toctext">Rack Timeout</span></a></li><li class="toc_level-1 toc_section-6"><a href="#sql-injection"><span class="tocnumber">4</span> <span class="toctext">SQL Injection</span></a></li><li class="toc_level-1 toc_section-7"><a href="#ssl"><span class="tocnumber">5</span> <span class="toctext">SSL</span></a></li><li class="toc_level-1 toc_section-8"><a href="#csp"><span class="tocnumber">6</span> <span class="toctext">CSP</span></a></li><li class="toc_level-1 toc_section-9"><a href="#iptables"><span class="tocnumber">7</span> <span class="toctext">Iptables</span></a></li><li class="toc_level-1 toc_section-10"><a href="#monit"><span class="tocnumber">8</span> <span class="toctext">Monit</span></a></li><li class="toc_level-1 toc_section-11"><a href="#sample-security-app"><span class="tocnumber">9</span> <span class="toctext">Sample security app</span></a></li><li class="toc_level-1 toc_section-12"><a href="#tips"><span class="tocnumber">10</span> <span class="toctext">Tips</span></a></li></ul></td></tr></tbody></table></div><ul>
  <li><a href="https://www.owasp.org/index.php/Category:Attack">OWASP</a> nice examples of
attack and vulnerability
<a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">XSS</a> there you can
see first two links:</li>
</ul>
<p><a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet</a>
<a href="https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet</a>
Some rails securiry related staff
https://github.com/pxlpnk/awesome-ruby-security</p>

<ul>
  <li>html image src could be stored:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IMG SRC=/ onerror="console.log('cao. bolje da eskejpujete sadrzaj');location.assign('http://www.iznajmljivanjeprojektoranovisad.in.rs')"&gt;&lt;/img&gt;
</code></pre></div></div>

<p>In rails you can simulate with:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user.name = 'Name "&gt;&lt;img src=x onerror=alert("Hi")&gt;'
user.save
# so there is a problem if you have in view
&lt;%= user.name.html_safe %&gt;
&lt;%=raw user.name %&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>inspect post/patch request in chrome developer tools on Network tab, right
click on request and “Copy as cURL”, and update fields to insert your html</p>
  </li>
  <li>
    <p>in rails, copy as curl, for xhr post, I need to add <code class="highlighter-rouge">--request PATCH and
--data @data.txt</code> and to join all lines with <code class="highlighter-rouge">&amp;</code> in data.txt from <code class="highlighter-rouge">Copy all
Data</code>.</p>
  </li>
</ul>

<p>Prevent injection with
<a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet#Output_Encoding_Rules_Summary">https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet#Output_Encoding_Rules_Summary</a></p>
<ul>
  <li>html entity: <code class="highlighter-rouge">&amp;</code> to <code class="highlighter-rouge">&amp;amp;</code>, <code class="highlighter-rouge">&lt;</code> to <code class="highlighter-rouge">&amp;lt;</code>, <code class="highlighter-rouge">&gt;</code> to <code class="highlighter-rouge">&amp;gt;</code>, quotation mark <code class="highlighter-rouge">"</code>
to <code class="highlighter-rouge">&amp;quot;</code> (<code class="highlighter-rouge">&amp;#22;</code> hex <code class="highlighter-rouge">&amp;34;</code> dec), apostrophe <code class="highlighter-rouge">'</code> to <code class="highlighter-rouge">&amp;x27;</code> (<code class="highlighter-rouge">&amp;39;</code>
decimal), <code class="highlighter-rouge">/</code> to <code class="highlighter-rouge">&amp;#x2f;</code> <a href="https://www.w3schools.com/html/html_charset.asp">https://www.w3schools.com/html/html_charset.asp</a></li>
  <li>html attribute: escape all characters except aphanumeric with html entity
<code class="highlighter-rouge">&amp;#xHH;</code> and space <code class="highlighter-rouge">&amp;#x;</code></li>
  <li>url encoding: use percent encoding <code class="highlighter-rouge">%XX</code> only for parametar values, not the
url of path fragments. Space is replaced with <code class="highlighter-rouge">+</code> or <code class="highlighter-rouge">%20</code>, <code class="highlighter-rouge">"</code> to <code class="highlighter-rouge">%22</code>, <code class="highlighter-rouge">#</code>
to <code class="highlighter-rouge">%23</code>, <code class="highlighter-rouge">$</code> to <code class="highlighter-rouge">%24</code>, <code class="highlighter-rouge">%</code> to <code class="highlighter-rouge">%25</code>, <code class="highlighter-rouge">&amp;</code> to <code class="highlighter-rouge">%26</code>, <code class="highlighter-rouge">'</code> to <code class="highlighter-rouge">%27</code>, <code class="highlighter-rouge">(</code> to
<code class="highlighter-rouge">%28</code>, <code class="highlighter-rouge">)</code> to <code class="highlighter-rouge">%29</code>, <code class="highlighter-rouge">.</code> to <code class="highlighter-rouge">%2E</code>, <code class="highlighter-rouge">/</code> to <code class="highlighter-rouge">%2F</code>, <code class="highlighter-rouge">:</code> to <code class="highlighter-rouge">%3A</code></li>
  <li>javascript: escape all chards with <code class="highlighter-rouge">\uXXXX</code> unicode escaping format</li>
  <li>css hex encoding</li>
</ul>

<p>In ruby you can escape query params</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  require 'uri'

  enc_uri = URI.escape("http://example.com/?a=\11\15")
  p enc_uri
  # =&gt; "http://example.com/?a=%09%0D"

  p URI.unescape(enc_uri)
  # =&gt; "http://example.com/?a=\t\r"
</code></pre></div></div>

<p>Some common escaped characters are: blank, slash <code class="highlighter-rouge">URI.escape " /" # %20%2f</code>
  but <code class="highlighter-rouge">escape</code> does not convert <code class="highlighter-rouge">/</code> to <code class="highlighter-rouge">%2f</code></p>

<h1 id="dos-attack">DOS attack</h1>

<ul>
  <li><code class="highlighter-rouge">sudo hping3 -c 10000 -d 120 -S -w 64 -p 21 --flood --rand-source
myapp.herokuapp.com</code></li>
  <li>you can generate authnentication key for http basic authentication with</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auth=`echo -n 'username:password' | openssl base64`
</code></pre></div></div>

<h2 id="siege">Siege</h2>

<p>Run 25 concurent users 1 minute with basic http authorization:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>siege myapp.herokuapp.com -c25 -t1M -H "Authorization: Basic
bmalrb2xhb2I6bmlrb2xhamVjYXI="
</code></pre></div></div>

<h2 id="ab">AB</h2>

<p>Run 500 requests in 5 threads:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ab -n 500 -c 5 -H 'Authorization:Basic barb2xhb2I6bmlrb2xhamVjYXI=' http://yourapp.com/
ab -kc 10 -t 10 url # 10 seconds in 10 threads
</code></pre></div></div>

<h1 id="rack-attack">Rack Attack</h1>

<p>You can use <a href="https://github.com/kickstarter/rack-attack">rack-attack gem</a> to
prevent dos attacks. It will allow all requests from <code class="highlighter-rouge">saveflist</code> and exit.
Otherwise it will ban all requests from <code class="highlighter-rouge">blocklist</code> and exit. Otherwise it will
check for throttle.  <a href="https://github.com/kickstarter/rack-attack/wiki/Example-Configuration">Example
configuration</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'rack-attack' &gt;&gt; Gemfile
bundle
sed -i config/application.rb -e '/^  end$/i \
    config.middleware.use Rack::Attack'
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># config/initializers/rack_attack.rb
module Rack
  class Attack
    # https://github.com/kickstarter/rack-attack/wiki/Example-Configuration
    THROTTLED_BLOCKED_INTERVAL = 1.hour

    # Key: "rack::attack:#{Time.now.to_i/:period}:req/ip:#{req.ip}"
    throttle('req/ip', limit: 300, period: 5.minutes) do |req|
      req.ip unless req.path.starts_with?('/assets')
    end

    # Key: "rack::attack:#{Time.now.to_i/:period}:logins/email:#{req.ip}"
    throttle('logins/email', limit: 5, period: 20.seconds) do |req|
      req.params['user'].try(:[], "email") if req.path == '/users/sign_in' &amp;&amp;
                                              req.post?
    end

    blocklist('blocklist_ips 1.2.3.4') do |req|
      Rails.cache.fetch("blocklist_ips #{req.ip}").present?
    end

    OFFICE_IP = '1.2.3.4'
    blocklist('bad_admin_ip') do |req|
      req.path.start_with?('/admin') &amp;&amp; req.ip != OFFICE_IP
    end

    safelist('safelist_ips 1.2.3.4') do |req|
      # if req.ip == "127.0.0.1"
      #   true
      # else
      #   Rails.cache.fetch("safelist_ips #{req.ip}").present?
      # end
      Rails.cache.fetch("safelist_ips #{req.ip}").present?
    end

    self.blocklisted_response = lambda do |env|
      ip = find_ip_from_env(env)
      unless Rails.cache.fetch("notification_block #{ip}").present?
        Rails.cache.write("notification_block #{ip}", true, expires_in: 1.hour)
        Notify.exception_with_env(
          "ip_blocklist",
          env: env,
          email_prefix: "just to notify (in this hour) that #{ip} tried again")
      end
      # Using 503 because it may make attacker think that they have successfully
      # DOSed the site. Rack::Attack returns 403 for blocklists by default
      [503, {}, [
        "Your IP address (#{ip}) has been blocked. If you think that this a "\
        "mistake please write to info@xceednet.com"]]
    end

    self.throttled_response = lambda do |env|
      ip = find_ip_from_env(env)
      if ip.present?
        Rails.cache.write("blocklist_ips #{ip}", true,
                          expires_in: THROTTLED_BLOCKED_INTERVAL)
        Rails.logger.info "throttled response: temporary adding #{ip} to "\
        "blocklist_ips"
        Notify.exception_with_env(
          "ip_throttle",
          env: env,
          email_prefix: "just info that #{ip} is on blocklist for some time",
          data: {
            help_text: "You can remove this temporary block in rails console "\
            "with this command (note that throttle still works):
            rake rack_attack:remove_from_blocklist_ips[#{ip}]
            ')" }
        )
      else
        Rails.logger.info "throttled response, but do not know ip address"
      end

      # Using 503 because it may make attacker think that they have successfully
      # DOSed the site. Rack::Attack returns 429 for throttling by default
      # [ 503, {}, [body]]
      [503, {}, ["Try later"]]
    end

    def self.find_ip_from_env(env)
      if env["REMOTE_ADDR"].present?
        env["REMOTE_ADDR"]
      else
        # heroku
        env["HTTP_X_FORWARDED_FOR"]
      end
    end
  end
end
</code></pre></div></div>

<p>You can test with command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ab -n 350 http://localhost:3000
</code></pre></div></div>

<p>Default rails cache is file, so you need to <code class="highlighter-rouge">rm -rf tmp/cache</code> if you want to
test clean situation.</p>

<p>If you receive too much 404 in logs, you can ban ip addreses
<a href="http://marianposaceanu.com/articles/keep-your-rails-logs-free-of-unwanted-noise">http://marianposaceanu.com/articles/keep-your-rails-logs-free-of-unwanted-noise</a>
For example block ip address for one day if request is made to
<code class="highlighter-rouge">/{wp-admin|wp-login}</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># After 1 blocked requests in 10 minutes, block all requests from that IP for 1 day.
Rack::Attack.blocklist('fail2ban pentesters') do |req|
  # `filter` returns truthy value if request fails, or if it's from a previously banned IP so the request is blocked
  Rack::Attack::Fail2Ban.filter(
    "pentesters-#{req.ip}",
    maxretry: 1,
    findtime: 10.minutes,
    bantime: 1.day
  ) do
    # The count for the IP is incremented if the return value is truthy
    req.path.include?('wp-admin') ||
    req.path.include?('wp-login')
  end
end
</code></pre></div></div>

<h1 id="rack-timeout">Rack Timeout</h1>

<p>You can use <code class="highlighter-rouge">rack-timeout</code> gem to abort requests that takes too long. For
example on Heroku there is a limit of 30seconds and longer requests are simply
canceled (there is no Expection notification in this case). Solution is to
manually cancel requests that takes 29 seconds and use 1 second to send
notification.
https://github.com/heroku/rack-timeout
To resolve this problem you should but those requests to background jobs.</p>

<h1 id="sql-injection">SQL Injection</h1>

<ul>
  <li><a href="http://rails-sqli.org/">rails-sqli</a> list of common injections</li>
  <li>external params should be sanitized <code class="highlighter-rouge">where("id = ?", params[:id])</code> or
<code class="highlighter-rouge">where("id = :id", id: params[:id])</code></li>
  <li>
    <p>with <code class="highlighter-rouge">order</code> we can not use sanitizations <code class="highlighter-rouge">?</code> or <code class="highlighter-rouge">:id</code> method. So do not use
string interpolation since anybody can do anything (drop table, get access). You
can try with adding <code class="highlighter-rouge">limit 1#</code> (<code class="highlighter-rouge">#</code> is <code class="highlighter-rouge">%23</code>
<a href="http://www.w3schools.com/tags/ref_urlencode.asp">encoded</a>) for example
<code class="highlighter-rouge">?sort=created_at&amp;direction=asc+limit+1%23</code>. Solution is to use methods that
returns only column names</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app/controllers/application_controller.rb
def sort_column
  %w[id name created_at].include?(params[:sort])) ? params[:sort] : "id"
end

def sort_direction
  %w[asc desc].include?(params[:direction]) ?  params[:direction] : "desc"
end

def sort_query
  "#{sort_column} #{sort_direction}"
end

# use like: User.order(sort_query)
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="ssl">SSL</h1>

<p>Add <a href="/2015/10/08/free-ssl-for-https-on-apache-or-nginx/">free ssl</a></p>

<ul>
  <li>
    <p>Test if it is working <a href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a> try config with
Mozzila ssl config generator
https://mozilla.github.io/server-side-tls/ssl-config-generator/</p>
  </li>
  <li>Add your site to hsts list <a href="https://hstspreload.org/">https://hstspreload.org/</a> so major browser will
use https instead http (can’t use http).
    <ul>
      <li>if server reply with <code class="highlighter-rouge">Strict-Transport-Security: max-age=16070400;
includeSubDomains</code> than browser will always use https
<a href="https://www.chromium.org/hsts">source</a>. For initial request browser maintains
“hsts preload list” <a href="https://hstspreload.org">https://hstspreload.org</a> where you can submit your sites
<a href="https://ma.ttias.be/chrome-force-dev-domains-https-via-preloaded-hsts/">google owns .dev and put it on hsts
list</a>
so it will use https instead http for <code class="highlighter-rouge">my-domain.dev</code>.</li>
    </ul>
  </li>
  <li>If not using https than ISP or Browser can easilly inject javascript into the
page and show adds.</li>
  <li>If you have password field on a page, browsers will require https or show a
“Not Secure Warning”.</li>
  <li>It is mandatory for HTTP 2.0.</li>
  <li>Some browsers features are only available over HTTPS: geolocation, service
workers, fullscreen…</li>
</ul>

<h1 id="csp">CSP</h1>

<p><a href="https://www.randomerrata.com/articles/2017/rails-security/">https://www.randomerrata.com/articles/2017/rails-security/</a>
CSP content security policy is header that tells browser where assets can be
loaded from.
Rails initialy gives us protection from: CSRF, XSS, Injection (SQL, HTML,
Javascript).
Default headers: X-Frame-Options, X-XSS-Protection, X-Content-Type-Options.</p>

<p>Gem <a href="https://github.com/twitter/secureheaders">https://github.com/twitter/secureheaders</a> can be added (just add to your
Gemfile <code class="highlighter-rouge">gem 'secure_headers'</code> and create configuration</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># config/initializers/secure_headers.rb
SecureHeaders::Configuration.default do |config|
end
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Content-Security-Policy:
# allow only scripts from the same origin as the page
script-src 'self'
# allow only scripts from the same origin as the page and google
script-src 'self' https://apis.google.com
# allow all sources but disallow unsafe inline assets
script-src *
# allow all and allow inline
script-src * 'unsafe-inline'

# reporting to
report-uri https://xceednet.report-uri.io/r/default/csp/reportOnly
</code></pre></div></div>

<p>Content-Security-Policy-Report-Only</p>

<p><a href="https://github.com/gbataille/csp_report">https://github.com/gbataille/csp_report</a>
You can deploy to production using <em>Report only</em> so you can see what assets are
used and add them one by one.</p>

<p>You can test if browser is injecting js
<a href="https://gist.github.com/danharper/8364399">https://gist.github.com/danharper/8364399</a></p>

<p>Tutorial <a href="https://chase.pursu.es/simple-intro-to-csp-for-rails.html">https://chase.pursu.es/simple-intro-to-csp-for-rails.html</a></p>

<h1 id="iptables">Iptables</h1>

<p>There are 3 types of chains: input, forward and output (some services like <code class="highlighter-rouge">ssh</code>
use both input and output chains). Default policy (for example <code class="highlighter-rouge">ACCEPT</code>) is used
for unmatched traffic. Response could be <code class="highlighter-rouge">Accept</code>, <code class="highlighter-rouge">Drop</code> (do not notify the
source) and <code class="highlighter-rouge">Reject</code> (source knows that it was rejected).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># list all rules
iptables -L
# block all connections from 10.10.10.10
iptables -A INPUT -s 10.10.10.10 -j DROP
# block all connections from 10.10.10.10 for ssh
iptables -A INPUT -p tcp --dport ssh -s 10.10.10.10 -j DROP

# SSH connections FROM 10.10.10.10 are permitted, but SSH TO 10.10.10.10 are not
iptables -A INPUT -p tcp --dport ssh -s 10.10.10.10 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 22 -d 10.10.10.10 -m state --state ESTABLISHED -j ACCEPT
</code></pre></div></div>

<p><code class="highlighter-rouge">iptables-save</code> to save changes.</p>

<p>Example for WordPress useragent <code class="highlighter-rouge">verifying pingback from</code> ddos attack
<a href="https://www.christophe-casalegno.com/under-wordpress-pingback-ddos-attack-use-iptables/">https://www.christophe-casalegno.com/under-wordpress-pingback-ddos-attack-use-iptables/</a></p>

<h1 id="monit">Monit</h1>

<p>https://www.youtube.com/watch?v=wiRt3mY7Rrw</p>

<h1 id="sample-security-app">Sample security app</h1>

<p>https://github.com/OWASP/railsgoat/wiki/Rails-5-Tutorials</p>

<h1 id="tips">Tips</h1>

<ul>
  <li>use scoped find, instead of <code class="highlighter-rouge">Order.find params[:id]</code> use <code class="highlighter-rouge">current_user.orders
find params[:id]</code></li>
  <li>use rate limiting, for example facebook password recovery number is 6 digits,
and beta.facebook did not have rate limit, so you can try 1 milin numbers very
quickly</li>
  <li>do not trust the mobile app, for example mobile app make a failed payment and
than change the payment response to be success and send that to server</li>
  <li>if your server is doing curl requests for some user url, than user can set up
sftp or smtp requests to any server and hide itself</li>
  <li>use SHA 256 instead  md5 and SHA 1</li>
</ul>

<p><a href="https://github.com/eliotsykes/rails-security-checklist">https://github.com/eliotsykes/rails-security-checklist</a>
<a href="https://github.com/eliotsykes/real-world-rails">https://github.com/eliotsykes/real-world-rails</a>
https://github.com/pxlpnk/awesome-ruby-security</p>

</body>
  </article>

  
  
  
  
    
  
  
  
  
  
  
  
  

</div>

      </div>
    </div>

    <style type='text/css'>
      .similar-links {
        display: inline-block;
        padding: 10px;
      }
    </style>
    <footer class="site-footer">

      <div class="wrap">

        <h2 class="footer-heading">duleorlovic - web developer</h2>

        <div class="footer-col-1 column">
          <ul>
            <li><a href="http://duleorlovic.github.io/tips/">short indistinct tips</a></li>
          </ul>
        </div>

        <div class="footer-col-2 column">
          <ul>
            <li>
              <a href="https://github.com/duleorlovic">
                <span class="icon github">
                  <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                    c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                    c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                    c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                    C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                    c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                    c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                    c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                    c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                  </svg>
                </span>
                <span class="username">duleorlovic</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="footer-col-3 column">
          <p class="text">I am writing here some toughts during my work in Ruby on Rails, Javascript and other</p>
        </div>

      </div>

    </footer>

  </body>
</html>
