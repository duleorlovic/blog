<!DOCTYPE html>
<html>

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Sharetribe</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="I am writing here some toughts during my work in Ruby on Rails, Javascript and other">
      <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/assets/css/main.css">
      <link rel="stylesheet" href="/assets/css/toc.css">

  </head>

  <body>

    <header class="site-header">

      <div class="wrap">

        <a class="site-title" href="/">duleorlovic - web developer</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
               viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
              <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
                h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
                h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
                c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </a>
          <div class="trigger">
            
              <a class="page-link" href="/about/">About</a>
            
              
            
              
            
              
            
          </div>
        </nav>
        <small>tools like
          <a href=" 
            /2015/04/05/common-rails-bootstrap-snippets/"
            >Rails bootstrap</a>,
          <a href=" /2015/11/09/rails-testing/">Rails testing</a>
            and <a href=" 
            /2016/04/12/rails-tips/">Rails tips</a>
          are still in use so content can be updated!
          <a href="javascript:void(0)"
            onclick="document.getElementById('mc_embed_signup').classList.toggle('active');">Notify
          me</a>
        </small>
	  <!-- Begin MailChimp Signup Form -->
	  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
	  <style type="text/css">
		  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
		  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
		     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
	  </style>
	  <div id="mc_embed_signup" class="signup-form">
	    <form action="//trk.us14.list-manage.com/subscribe/post?u=819590ae53cb08bddb952ed97&amp;id=ec1213024d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<div id="mc_embed_signup_scroll">
	    <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
	    <div class="mc-field-group">
		    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
	    </label>
		    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	    </div>
		    <div id="mce-responses" class="clear">
			    <div class="response" id="mce-error-response" style="display:none"></div>
			    <div class="response" id="mce-success-response" style="display:none"></div>
		    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_819590ae53cb08bddb952ed97_ec1213024d" tabindex="-1" value=""></div>
		<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
		</div>
	    </form>
	  </div>
	  <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
	  <!--End mc_embed_signup-->

      </div>
    <!-- Html Elements for Search -->
    <div id="search-demo-container">
    <input type="text" id="search-input" placeholder="search...">
    <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to jekyll-search.js -->
    <script src="/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json',
      });
    </script>

    </header>
    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Sharetribe</h1>
    <p class="meta">Nov 17, 2017</p>
  </header>

  <article class="post-content">
  <body><div id="toc-container"><table class="toc" id="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div><ul><li class="toc_level-1 toc_section-1"><a href="#install"><span class="tocnumber">1</span> <span class="toctext">Install</span></a></li><li class="toc_level-1 toc_section-2"><a href="#development"><span class="tocnumber">2</span> <span class="toctext">Development</span></a></li><li class="toc_level-1 toc_section-3"><a href="#deploy-in-production"><span class="tocnumber">3</span> <span class="toctext">Deploy in production</span></a></li><li class="toc_level-1 toc_section-4"><a href="#adding-linkedin"><span class="tocnumber">4</span> <span class="toctext">Adding linkedin</span></a></li><li class="toc_level-1 toc_section-5"><a href="#contribute"><span class="tocnumber">5</span> <span class="toctext">Contribute</span></a></li><li class="toc_level-1 toc_section-6"><a href="#examples"><span class="tocnumber">6</span> <span class="toctext">Examples</span></a></li></ul></td></tr></tbody></table></div><h1 id="install">Install</h1>

<p><a href="https://github.com/sharetribe/sharetribe">https://github.com/sharetribe/sharetribe</a></p>

<p>If you have newer versions of <code class="highlighter-rouge">node 7.8</code> or <code class="highlighter-rouge">npm 4.2</code> than you should install
older <code class="highlighter-rouge">nvm install 7.8</code> and <code class="highlighter-rouge">npm install -g npm@4.2.0</code>.
If you dont see forms or other react components, than <code class="highlighter-rouge">rm -rf
client/node_modules/</code> and <code class="highlighter-rouge">npm install</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT=3001 foreman start -f Procfile.static
bundle exec rake jobs:work
</code></pre></div></div>

<p>Open <a href="http://lvh.me:5000/">http://lvh.me:5000/</a> or updated port <a href="http://lvh.me:3001/">http://lvh.me:3001/</a></p>

<p>Localy inspect mails that are send:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install mailcatcher
mailcatcher

# config/config.yml
development:
  mail_delivery_method: smtp
  smtp_email_address: "localhost"
  smtp_email_port: 1025
</code></pre></div></div>

<p>Open <a href="http://localhost:1080">http://localhost:1080</a></p>

<h1 id="development">Development</h1>

<p><a href="https://github.com/sharetribe/sharetribe/tree/master/docs">https://github.com/sharetribe/sharetribe/tree/master/docs</a></p>

<h1 id="deploy-in-production">Deploy in production</h1>

<p><a href="https://github.com/sharetribe/sharetribe#setting-up-sharetribe-for-production">https://github.com/sharetribe/sharetribe#setting-up-sharetribe-for-production</a></p>

<p>First checkout latest
<a href="https://github.com/sharetribe/sharetribe/releases">release</a>.</p>

<p>Keys for AWS S3 and stmp emails are stored in <code class="highlighter-rouge">config/config.defaults.yml</code>.
It does not accepts <code class="highlighter-rouge">&lt;%= ENV[""] %&gt;</code> but you can override with env with the same
<strong>lowercase</strong> names.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># config/keys/sharetribe.sh
# domain
export domain=my-domain.com

# aws is used from my_keys, but need lowercase
export s3_bucket_name=$AWS_BUCKET_NAME
export s3_region=$AWS_REGION
export s3_upload_bucket_name=$AWS_BUCKET_NAME
export aws_access_key_id=$AWS_ACCESS_KEY_ID
export aws_secret_access_key=$AWS_SECRET_ACCESS_KEY

# mail using my gmail
export mail_delivery_method=smtp
export smtp_email_address=smtp.gmail.com
export smtp_email_port=587
export smtp_email_user_name=$GMAIL_EMAIL
export smtp_email_password=$GMAIL_PASSWORD
export smtp_email_domain=gmail.com

# google api key for maps
export google_maps_key=$GOOGLE_API_KEY

# facebook
export fb_connect_id=$FACEBOOK_KEY
export fb_connect_secret=$FACEBOOK_SECRET

# all in heroku command
heroku config:set domain=my-domain.com s3_bucket_name=$AWS_BUCKET_NAME s3_region=$AWS_REGION s3_upload_bucket_name=$AWS_BUCKET_NAME aws_access_key_id=$AWS_ACCESS_KEY_ID aws_secret_access_key=$AWS_SECRET_ACCESS_KEY mail_delivery_method=smtp smtp_email_address=smtp.gmail.com smtp_email_port=587 smtp_email_user_name=$GMAIL_EMAIL smtp_email_password=$GMAIL_PASSWORD smtp_email_domain=gmail.com google_maps_key=$GOOGLE_API_KEY fb_connect_id=$FACEBOOK_KEY fb_connect_secret=$FACEBOOK_SECRET
</code></pre></div></div>

<p>Domain is root domain, and each community is under subdomain.</p>

<p>Sphinx needs access to mysql so download credentials from clearDB dashboard and
save to <code class="highlighter-rouge">lib/certificates</code> folder. Edit <code class="highlighter-rouge">config/thinking_sphinx.yml</code> to point to
those files. Key needs to be without password.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsa -in cleardb_id-key.pem -out cleardb_id-key-no-password.pem
vi config/thinking_sphinx.yml
production:
  mysql_ssl_ca: lib/certificates/cleardb-ca.pem
  mysql_ssl_cert: lib/certificates/cleardb_id-cert.pem
  mysql_ssl_key: lib/certificates/cleardb_id-key-no-password.pem

heroku run bundle exec flying-sphinx configure
heroku run bundle exec flying-sphinx rebuild
heroku run bundle exec flying-sphinx index
heroku run bundle exec flying-sphinx start
</code></pre></div></div>

<p>Scheduler tasks
<a href="https://github.com/sharetribe/sharetribe/blob/master/docs/scheduled_tasks.md">https://github.com/sharetribe/sharetribe/blob/master/docs/scheduled_tasks.md</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku addons:create scheduler:standard
heroku addons:open scheduler

# create three tasks, first is hourly other are daily
bundle exec rails runner ActiveSessionsHelper.cleanup
bundle exec rails runner CommunityMailer.deliver_community_updates
bundle exec rake sharetribe:delete_expired_auth_tokens
</code></pre></div></div>

<p>For Heroku use the same steps.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku config:set PASSENGER_MAX_POOL_SIZE=3
heroku run bundle exec rake db:structure:load
</code></pre></div></div>

<p>Problem with <code class="highlighter-rouge">Please check the output above for any errors and make sure that
</code>mysql<code class="highlighter-rouge"> is installed in your PATH and has proper permissions.</code> is reported
https://github.com/sharetribe/sharetribe/issues/2981 and you need to install
buildpack <a href="https://stackoverflow.com/a/47392242/287166">https://stackoverflow.com/a/47392242/287166</a></p>

<h1 id="adding-linkedin">Adding linkedin</h1>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># linkedin
export linkedin_client_id=$LINKEDIN_CLIENT_ID
export linkedin_client_secret=$LINKEDIN_CLIENT_SECRET

heroku config:set linkedin_client_id=$LINKEDIN_CLIENT_ID linkedin_client_secret=$LINKEDIN_CLIENT_SECRET

# config/initializers/devise.rb
  config.omniauth :linkedin, APP_CONFIG.linkedin_client_id, APP_CONFIG.linkedin_client_secret
</code></pre></div></div>

<h1 id="contribute">Contribute</h1>

<p><a href="https://github.com/sharetribe/sharetribe/blob/master/app/models/person.rb#L518">https://github.com/sharetribe/sharetribe/blob/master/app/models/person.rb#L518</a>
logger is using Rails logger instead of SharetribeLogger.</p>

<h1 id="examples">Examples</h1>

<ul>
  <li>interesting example <a href="https://www.sharegrid.com/">https://www.sharegrid.com/</a></li>
</ul>
</body>
  </article>

  
  
  
  
    
  
  
  
  
  
  
  
  

</div>

      </div>
    </div>

    <style type='text/css'>
      .similar-links {
        display: inline-block;
        padding: 10px;
      }
    </style>
    <footer class="site-footer">

      <div class="wrap">

        <h2 class="footer-heading">duleorlovic - web developer</h2>

        <div class="footer-col-1 column">
          <ul>
            <li><a href="http://duleorlovic.github.io/tips/">short indistinct tips</a></li>
          </ul>
        </div>

        <div class="footer-col-2 column">
          <ul>
            <li>
              <a href="https://github.com/duleorlovic">
                <span class="icon github">
                  <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                    c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                    c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                    c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                    C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                    c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                    c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                    c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                    c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                  </svg>
                </span>
                <span class="username">duleorlovic</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="footer-col-3 column">
          <p class="text">I am writing here some toughts during my work in Ruby on Rails, Javascript and other</p>
        </div>

      </div>

    </footer>

  </body>
</html>
