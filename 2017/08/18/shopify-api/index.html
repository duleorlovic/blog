<!DOCTYPE html>
<html>

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Shopify Api</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="I am writing here some toughts during my work in Ruby on Rails, Javascript and other">
      <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/assets/css/main.css">
      <link rel="stylesheet" href="/assets/css/toc.css">

  </head>

  <body>

    <header class="site-header">

      <div class="wrap">

        <a class="site-title" href="/">duleorlovic - web developer</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
               viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
              <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
                h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
                h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
                c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </a>
          <div class="trigger">
            
              <a class="page-link" href="/about/">About</a>
            
              
            
              
            
              
            
          </div>
        </nav>
        <small>tools like
          <a href=" 
            /2015/04/05/common-rails-bootstrap-snippets/"
            >Rails bootstrap</a>,
          <a href=" /2015/11/09/rails-testing/">Rails testing</a>
            and <a href=" 
            /2016/04/12/rails-tips/">Rails tips</a>
          are still in use so content can be updated!
          <a href="javascript:void(0)"
            onclick="document.getElementById('mc_embed_signup').classList.toggle('active');">Notify
          me</a>
        </small>
	  <!-- Begin MailChimp Signup Form -->
	  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
	  <style type="text/css">
		  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
		  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
		     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
	  </style>
	  <div id="mc_embed_signup" class="signup-form">
	    <form action="//trk.us14.list-manage.com/subscribe/post?u=819590ae53cb08bddb952ed97&amp;id=ec1213024d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<div id="mc_embed_signup_scroll">
	    <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
	    <div class="mc-field-group">
		    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
	    </label>
		    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	    </div>
		    <div id="mce-responses" class="clear">
			    <div class="response" id="mce-error-response" style="display:none"></div>
			    <div class="response" id="mce-success-response" style="display:none"></div>
		    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_819590ae53cb08bddb952ed97_ec1213024d" tabindex="-1" value=""></div>
		<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
		</div>
	    </form>
	  </div>
	  <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
	  <!--End mc_embed_signup-->

      </div>
    <!-- Html Elements for Search -->
    <div id="search-demo-container">
    <input type="text" id="search-input" placeholder="search...">
    <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to jekyll-search.js -->
    <script src="/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json',
      });
    </script>

    </header>
    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Shopify Api</h1>
    <p class="meta">Aug 18, 2017</p>
  </header>

  <article class="post-content">
  <body><div id="toc-container"><table class="toc" id="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div><ul><li class="toc_level-1 toc_section-1"><a href="#creating-new-app"><span class="tocnumber">1</span> <span class="toctext">Creating new app</span></a></li><li class="toc_level-1 toc_section-2"><a href="#heroku"><span class="tocnumber">2</span> <span class="toctext">Heroku</span></a></li><li class="toc_level-1 toc_section-3"><a href="#oauth"><span class="tocnumber">3</span> <span class="toctext">OAuth</span></a></li><li class="toc_level-1 toc_section-4"><a href="#private-app"><span class="tocnumber">4</span> <span class="toctext">Private app</span></a></li><li class="toc_level-1 toc_section-5"><a href="#api"><span class="tocnumber">5</span> <span class="toctext">API</span></a></li><li class="toc_level-1 toc_section-6"><a href="#webhooks"><span class="tocnumber">6</span> <span class="toctext">Webhooks</span></a></li><li class="toc_level-1 toc_section-7"><a href="#application-proxy"><span class="tocnumber">7</span> <span class="toctext">Application proxy</span></a></li><li class="toc_level-1 toc_section-8"><a href="#polaris-and-react-components"><span class="tocnumber">8</span> <span class="toctext">Polaris and react components</span></a></li><li class="toc_level-1 toc_section-9"><a href="#application-admin-links"><span class="tocnumber">9</span> <span class="toctext">Application admin links</span></a></li><li class="toc_level-1 toc_section-10"><a href="#modify-online-store-using-scripttag"><span class="tocnumber">10</span> <span class="toctext">Modify online store using ScriptTag</span></a></li><li class="toc_level-1 toc_section-11"><a href="#authorize"><span class="tocnumber">11</span> <span class="toctext">Authorize</span></a></li><li class="toc_level-1 toc_section-12"><a href="#apps"><span class="tocnumber">12</span> <span class="toctext">Apps</span></a></li><li class="toc_level-1 toc_section-13"><a href="#publishing-your-app"><span class="tocnumber">13</span> <span class="toctext">Publishing your app</span></a></li><li class="toc_level-1 toc_section-14"><a href="#opensource-examples"><span class="tocnumber">14</span> <span class="toctext">Opensource examples</span></a></li></ul></td></tr></tbody></table></div><h1 id="creating-new-app">Creating new app</h1>

<p><a href="https://help.shopify.com/api/getting-started">https://help.shopify.com/api/getting-started</a> On <a href="https://partners.shopify.com">https://partners.shopify.com</a>
create account and development store like
<a href="https://duleorlovic-test.myshopify.com/">https://duleorlovic-test.myshopify.com/</a>.</p>

<p>You can use https://shopify.github.io/shopify-app-cli/ shopify cli to create app</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval "$(curl -sS https://raw.githubusercontent.com/Shopify/shopify-app-cli/master/install.sh)"
shopify help
shopify logout # remove credentials for organization and shop

shopify create rails
? App Name
&gt; testing_multiple_accounts
? What type of app are you building? (You chose: Public: An app built for a wide merchant audience.)
### First time it will ask for api key confirmation
ğ’¾ Authentication required. Login to the URL below with your Shopify Partners account credentials to continue.
Please open this URL in your browser:
https://accounts.shopify.com/oauth/authorize?client_id=fbdb2649-e327-4907--908d24cfd7e3&amp;scope=openid+https%3A%2F%2Fapi.shopify.com%2Fauth%2Fpartners.app.cli.access&amp;redirect_uri=http%3A%2F%2F127.0.0.1%3A3456&amp;state=fe3f5f7289435ba6ca1a856f
? Select organization (Choose with â†‘ â†“ â, filter with 'f')
&gt; 1. TRK Innovations
  2. TRK INNOVATIONS
? Select organization (You chose: TRK Innovations)
âœ— No Development Stores available.                                                                  
Visit https://partners.shopify.com/830170/stores to create one                                      
For authentication issues, run shopify logout to clear invalid credentials
### If you already saved some account
Organization Kajakas                                                                                
Using Development Store kulakajak.myshopify.com                                                     
â”â”â” Installing bundlerâ€¦ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” (0.0s) â”â”
â”â”â” Generating new rails app project in testing_multiple_accounts... â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”ƒ Using  from /home/orlovic/.railsrc
â”ƒ       create  
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” (18.25s) â”â”
â”â”â” Running migrationsâ€¦ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”ƒ == 20200603053952 CreateShops: migrating ======================================
â”ƒ -- create_table(:shops)
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” (4.29s) â”â”
âœ“ writing .env file...
âœ“ testing_multiple_accounts was created in your Partner Dashboard https://partners.shopify.com/1577787/apps/3913425
â­‘ Run shopify serve to start a local server
â­‘ Then, visit https://partners.shopify.com/1577787/apps/3913425/test to install testing_multiple_accounts on your Dev Store
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">shopify create</code> can give an error
<code class="language-plaintext highlighter-rouge">/Users/orlovic/.shopify-app-cli/lib/shopify-cli/api.rb:72:in block in request':
500 (ShopifyCli::API::APIRequestServerError</code> when there are multiple
organizations https://github.com/Shopify/shopify-app-cli/issues/450
also it lists disabled organizations https://github.com/Shopify/shopify-app-cli/issues/639</p>

<p>To remove/uninstall you can run <code class="language-plaintext highlighter-rouge">rm -rf ~/.shopify-app-cli/</code> or <code class="language-plaintext highlighter-rouge">shopify logout</code>
This command will install latest rails, add <code class="language-plaintext highlighter-rouge">gem 'shopify_app'</code>, create <code class="language-plaintext highlighter-rouge">.env</code>
file with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># .env
SHOPIFY_API_KEY=ba...
SHOPIFY_API_SECRET_KEY=shpss_7b...
SHOP=kulakajak.myshopify.com
SCOPES=write_products,write_customers,write_draft_orders
</code></pre></div></div>

<p>I had a problem when I use old env <code class="language-plaintext highlighter-rouge">SHOPIFY_API_SECRET</code> but new version is
<code class="language-plaintext highlighter-rouge">SHOPIFY_API_SECRET_KEY</code> https://github.com/Shopify/shopify_app/issues/1009</p>

<p>Runing <code class="language-plaintext highlighter-rouge">shopify serve</code> will run <code class="language-plaintext highlighter-rouge">ngrok http 8081</code> and <code class="language-plaintext highlighter-rouge">rails s -p 8081</code>.</p>

<p>Manually running you need to create an App and add ngrok urls. Create on
https://partners.shopify.com/648793/apps/new . <strong>App -&gt; App Info -&gt; App Url</strong>
has to be https, and you can you ngrok https url <a href="https://159abd37.ngrok.io/">https://159abd37.ngrok.io/</a>
and Whitelisted redirection URL
<a href="https://159abd37.ngrok.io/auth/shopify/callback">https://159abd37.ngrok.io/auth/shopify/callback</a> Use ngrok url when installing
the app, since if you install from <a href="http://localhost">http://localhost</a> then <code class="language-plaintext highlighter-rouge">Oauth error
invalid_request: The redirect_uri is not whitelisted</code> is raised. This is also
raised when you use <code class="language-plaintext highlighter-rouge">http</code> instead <code class="language-plaintext highlighter-rouge">https</code>.  Copy credentials from Apps -&gt; App
info -&gt; App credentials and store them in <code class="language-plaintext highlighter-rouge">SHOPIFY_API_KEY</code> and
<code class="language-plaintext highlighter-rouge">SHOPIFY_SECRET_KEY</code>.</p>

<p>Note that protocol should be https (admin store is always redirected to https),
because if we use <code class="language-plaintext highlighter-rouge">http://159abd37.ngrok.io</code> there will be a warning:
<code class="language-plaintext highlighter-rouge">Shopify.AppMessenger received message null from unexpected origin
https://159abd37.ngrok.io ; expecting http://159abd37.ngrok.io or subdomain
thereof</code></p>

<p>Install <a href="https://developer-tools.shopifyapps.com/install">https://developer-tools.shopifyapps.com/install</a> to load sample
generated data.</p>

<p>Create new rails and add gem <a href="https://github.com/Shopify/shopify_app">https://github.com/Shopify/shopify_app</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails new shopify_test -d postgresql
cd shopify_test
rake db:create
git init . &amp;&amp; git add . &amp;&amp; git commit -am "rails new"
cat &gt; config/secrets.yml &lt;&lt; HERE_DOC
shared:
  secret_key_base: &lt;%= ENV["SECRET_KEY_BASE"] || 'some_secret' %&gt;

  shopify_api_key: &lt;%= ENV["SHOPIFY_API_KEY"] %&gt;
  shopify_secret_key: &lt;%= ENV["SHOPIFY_SECRET_KEY"] %&gt;
HERE_DOC
echo "gem 'shopify_app'" &gt;&gt; Gemfile
bundle

rails generate shopify_app
#    generate  shopify_app:install
#      create  config/initializers/shopify_app.rb
#      create  config/initializers/omniauth.rb
#      insert  config/initializers/omniauth.rb
#      create  app/views/layouts/embedded_app.html.erb
#      create  app/views/layouts/_flash_messages.html.erb
#       route  mount ShopifyApp::Engine, at: '/'
#    generate  shopify_app:shop_model
#      create  app/models/shop.rb
#      create  db/migrate/20171103082230_create_shops.rb
#        gsub  config/initializers/shopify_app.rb
#      create  test/fixtures/shops.yml
#    generate  shopify_app:home_controller
rake db:migrate
sed -i config/initializers/shopify_app.rb -e '/&lt;api_key&gt;/c \
  config.api_key = Rails.application.secrets.shopify_api_key'
sed -i config/initializers/shopify_app.rb -e '/&lt;secret&gt;/c \
  config.secret = Rails.application.secrets.shopify_secret_key'
git add . &amp;&amp; git commit -m "rails g shopify_app"
</code></pre></div></div>

<p>When you navigate to <a href="https://159abd37.ngrok.io">https://159abd37.ngrok.io</a> for the first time you will be
asked for shop url, so enter <a href="https://duleorlovic-test.myshopify.com/">https://duleorlovic-test.myshopify.com/</a> or just a
name <code class="language-plaintext highlighter-rouge">duleorlovic-test</code> to install our app. Than enable Apps -&gt; App info -&gt;
Extensions -&gt; â€œEmbed in Shopify adminâ€.</p>

<p>You can use <code class="language-plaintext highlighter-rouge">ngrok http 3003</code> while you are developing.
Also <a href="https://requestb.in/">https://requestb.in/</a> and <a href="https://forwardhq.com/">https://forwardhq.com/</a></p>

<p>Only legacy app uses <code class="language-plaintext highlighter-rouge">embeded: false</code>. If you do not want to redirect to shopify
admin and be under iframe, you can disable redirect
<a href="https://github.com/Shopify/shopify_app#testing-an-embedded-app-outside-the-shopify-admin">https://github.com/Shopify/shopify_app#testing-an-embedded-app-outside-the-shopify-admin</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// app/views/layouts/embedded_app.html.erb
        forceRedirect: &lt;%= Rails.env.development? || Rails.env.test? ? 'false' : 'true' %&gt;
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">app/views/layouts/embedded_app.html.erb</code> layouts always used (and
not application layout).</p>

<h1 id="heroku">Heroku</h1>

<p>When you deploy to heroku you need to update Redirection URL or create another
app</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>heroku config:set SHOPIFY_API_KEY=$SHOPIFY_API_KEY SHOPIFY_SECRET_KEY=$SHOPIFY_SECRET_KEY SERVER_URL=https://`heroku domains | sed -n 2p`
</code></pre></div></div>

<p>Remember to reinstall application after the assets compilation is finished.
Also you can force oauth simply going on <code class="language-plaintext highlighter-rouge">/login</code> page, but this helps only with
webhooks. Script tags need reinstall. NOTE THAT USUALLY NEED TO RESTART RAILS
SERVER BEFORE THAT SO IT PICKS UP NEW DIGEST.</p>

<p>Use force ssl, so it is always using https (redirect url will be the same
protocol from which we started auth).</p>

<p>If there is a message for <code class="language-plaintext highlighter-rouge">/auth/failure</code> with <code class="language-plaintext highlighter-rouge">"message":"invalid_signature"</code>
than probably you already have existing shop with different API keys. So remove
any shops from database when you change API keys. Also might be that your API
SECRET is invalid.</p>

<p>If there is a message for your page
<code class="language-plaintext highlighter-rouge">duleorlovic-test.myshopify.com/admin/apps/12342134</code> with message <code class="language-plaintext highlighter-rouge">Not Found:
The page you were looking for does not exist.</code>â€¦ I do not know.</p>

<h1 id="oauth">OAuth</h1>

<p>Client is application that would like access to shops data.
First step is to redirect resource owner to authorization server and ask for
scopes (write_orders,read_customers), define redirect_uri and use option for
offline (default) or online access mode (current session).
When resource owner click Install they will be redirected to redirect_url with
authorization code.</p>

<p>If offline access mode, than authorization code is exchanged with permament
access token using <code class="language-plaintext highlighter-rouge">POST https://{shop}.myshopify.com/admin/oauth/access_token</code>
with <code class="language-plaintext highlighter-rouge">authorization_code</code>, <code class="language-plaintext highlighter-rouge">client_id</code> and <code class="language-plaintext highlighter-rouge">client_secret</code>.</p>

<h1 id="private-app">Private app</h1>

<p>You can generate keys for specific shop, got to you
<code class="language-plaintext highlighter-rouge">{shop_url}/admin/apps/private</code>. Enable what you need since by default not all
are enabled.</p>

<p>You can install <code class="language-plaintext highlighter-rouge">gem install shopify_api_console</code> <a href="https://github.com/Shopify/shopify_api#console">shopify-cli
console</a> to access resources
using pry</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shopify-api add duleorlovic-test
shopify-api console
ShopifyAPI::Product.find(:all)
</code></pre></div></div>

<p>Also, you can use postman to access requests.</p>

<h1 id="api">API</h1>

<p><a href="https://help.shopify.com/api/reference">https://help.shopify.com/api/reference</a>
When using api you can call <code class="language-plaintext highlighter-rouge">find</code> on two ways: <code class="language-plaintext highlighter-rouge">:all</code> or specific id.
When find is used with specific id it will raise exception if it is not found.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ShopifyAPI::Order.find 123456
ShopifyAPI::Order.find :all
</code></pre></div></div>

<p>If find is used with <code class="language-plaintext highlighter-rouge">:all</code> you can use additional <code class="language-plaintext highlighter-rouge">params</code> hash with:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">fields</code> which fields to return, can be array</li>
  <li><code class="language-plaintext highlighter-rouge">page</code> which page 1, 2, â€¦</li>
  <li><code class="language-plaintext highlighter-rouge">limit</code> default is 50 usuall max is 250</li>
  <li><code class="language-plaintext highlighter-rouge">ids</code> comma separated ids</li>
  <li><code class="language-plaintext highlighter-rouge">vendor</code> or any other field</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@orders = ShopifyAPI::Order.find(:all, params: {fields: "id,name,created_at,email,financial_status,total_price", financial_status: "pending", limit: 250})
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">where</code> could also work (no need to nest inside <code class="language-plaintext highlighter-rouge">params</code> hash):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ShopifyAPI::Product.where(ids: "8931567365")
# NOTE that single 'id' does not work, it returns all
ShopifyAPI::Product.where(id: "8931567365") # THIS DOES NOT WORK
# other fields are ok in singular - original field name
ShopifyAPI::Product.where(vendor: "duleorlovic-test")

# fields array, page and limit also works
ShopifyAPI::Product.where(vendor: "duleorlovic-test", fields: [:id, :title],
limit: 1, page: 2)
</code></pre></div></div>

<h1 id="webhooks">Webhooks</h1>

<p>You can generate config and job for webhook
<a href="https://github.com/Shopify/shopify_app#webhooksmanager">https://github.com/Shopify/shopify_app#webhooksmanager</a></p>

<p>Note that address needs to be different for each webhook and name is joined
item_action.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails g shopify_app:add_webhook -t carts/update -a https://example.com/webhooks/carts_update
</code></pre></div></div>

<p>This will generate something but you can add server url config:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  config.webhooks = [
    {
      topic: 'carts/update',
      address: Rails.application.secrets.server_url.to_S +
        '/webhooks/carts_update',
      format: 'json'
    },
  ]
</code></pre></div></div>

<p>Webhook is hash, so you need to access like <code class="language-plaintext highlighter-rouge">webhook[:line_items]</code>
Webhooks are regenerated by uninstalling and installing again the app. Also
retriggering the oauth flow also update webhooks (so no need to uninstall).
Job is created</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app/jobs/carts_update_job.rb
class CartsUpdateJob &lt; ActiveJob::Base
  def perform(shop_domain:, webhook:)
    shop = Shop.find_by(shopify_domain: shop_domain)

    shop.with_shopify_session do
      # do something with webhook hash
    end
  end
end
</code></pre></div></div>

<h1 id="application-proxy">Application proxy</h1>

<p>You can load productions from external source. Enable it on partners.shopify.com
-&gt; Apps -&gt; Extension -&gt; App proxy
sub path can be anything and proxy url should match exact path on server.
NOTE that this is settings for the app defaults. When user install the app, it
will use current settings, but they can customize subpath. You can change
subpath on the app and that will have no effects. But If you change proxy url
that will broke current applications unless you enable that url on server. So
that proxy url always should be working url.</p>

<p>On controller if you inherit from <code class="language-plaintext highlighter-rouge">ShopifyApp::AuthenticatedController</code> than you
should skip
~~
  skip_around_action :shopify_session, only: [:index]
  skip_before_action :login_again_if_different_shop, only: [:index]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Anyway for liquid you should set header and render without layout
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>render layout: false, content_type: 'application/liquid' ~~~
</code></pre></div></div>

<h1 id="polaris-and-react-components">Polaris and react components</h1>

<p><a href="https://polaris.shopify.com/components/get-started">https://polaris.shopify.com/components/get-started</a></p>

<h1 id="application-admin-links">Application admin links</h1>

<p>You can register admin links so user can use it from other admin pages
<a href="https://help.shopify.com/api/partner-dashboard/app-admin-access">https://help.shopify.com/api/partner-dashboard/app-admin-access</a>
Go to Partners -&gt; Apps -&gt; Extensions -&gt; Add an admin link</p>

<h1 id="modify-online-store-using-scripttag">Modify online store using ScriptTag</h1>

<p>Remote javascript can be loaded on pages of shopâ€™s storefront so shop owner do
not need to change theme files directly (and to revert changes when uninstalling
your app).</p>

<p>You can use template from
<a href="https://help.shopify.com/api/sdks/shopify-apps/modifying-online-store/use-javascript-responsibly">use javascript
responsibly</a>
and save it on <code class="language-plaintext highlighter-rouge">assets/storefront_javascript/loadSliders.js</code>.
Enable precompiling and rendering without digest</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;&gt; Gemfile &lt;&lt; HERE_DOC
# compile assets without digest
gem 'non-stupid-digest-assets'
HERE_DOC
bundle

cat &gt;&gt; config/initializers/assets.rb &lt;&lt; HERE_DOC
Rails.application.config.assets.precompile += %w[
  loadSliders.js
]
NonStupidDigestAssets.whitelist += %w[
  loadSliders.js
]
HERE_DOC
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">rake assets:precompile</code> should create <code class="language-plaintext highlighter-rouge">public/assets/loadSliders.js</code></p>

<p>Register script tag in <code class="language-plaintext highlighter-rouge">config/initializers/shopify_app.rb</code> as in example
<a href="https://github.com/Shopify/shopify_app#scripttagsmanager">https://github.com/Shopify/shopify_app#scripttagsmanager</a></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  config.scripttags = [
    { event: 'onload',
      src: "#{Rails.application.secrets.server_url}/assets/loadSliders.js" }
  ]
</code></pre></div></div>

<p>You need to restart rails and reinstall shopify app if you want to change src
url.
You can use non-stupid-digest-assets or you can use lambda for src.</p>

<h1 id="authorize">Authorize</h1>

<p>To authorize request:
https://help.shopify.com/api/tutorials/application-proxies#proxy-response</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  shop = request.params['shop']
  code = request.params['code']
  hmac = request.params['hmac']
  # perform hmac validation to determine if the request is coming from Shopify
  h = request.params.reject{|k,_| k == 'hmac'}
  query = URI.escape(h.sort.collect{|k,v| "#{k}=#{v}"}.join('&amp;'))
  digest = OpenSSL::HMAC.hexdigest(OpenSSL::Digest.new('sha256'), API_SECRET, query)
  if not (hmac == digest)
    return [403, "Authentication failed. Digest provided was: #{digest}"]
  end
</code></pre></div></div>

<h1 id="apps">Apps</h1>

<p>MULTI VENDOR LOKAL SELLER</p>
<ul>
  <li>multistore forum discussion: https://ecommerce.shopify.com/c/shopify-discussion/t/multiple-domain-under-one-account-140477</li>
  <li>one store multi users/vendors discussion https://ecommerce.shopify.com/c/shopify-discussion/t/user-level-accounts-366021</li>
  <li>supplier offering storefronts to distributors/end_stores. not possible with
one store since price should be different to each distributor.</li>
</ul>

<h1 id="publishing-your-app">Publishing your app</h1>

<p>You should attract your merchants to make a review and put stars on you app.
For example: We see youâ€™re seeing success with our app weâ€™d love it if you left
us a review [link].
When someone is talking to customer support and have good experience, customer
support says: Hey weâ€™d love itif you leave a review.</p>

<h1 id="opensource-examples">Opensource examples</h1>

<p><a href="https://github.com/julionc/awesome-shopify">https://github.com/julionc/awesome-shopify</a></p>
</body>
  </article>

  
  
  
  
    
  
  
  
  
  
  
  
  

</div>

      </div>
    </div>

    <style type='text/css'>
      .similar-links {
        display: inline-block;
        padding: 10px;
      }
    </style>
    <footer class="site-footer">

      <div class="wrap">

        <h2 class="footer-heading">duleorlovic - web developer</h2>

        <div class="footer-col-1 column">
          <ul>
            <li><a href="http://duleorlovic.github.io/tips/">short indistinct tips</a></li>
          </ul>
        </div>

        <div class="footer-col-2 column">
          <ul>
            <li>
              <a href="https://github.com/duleorlovic">
                <span class="icon github">
                  <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                    c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                    c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                    c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                    C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                    c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                    c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                    c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                    c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                  </svg>
                </span>
                <span class="username">duleorlovic</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="footer-col-3 column">
          <p class="text">I am writing here some toughts during my work in Ruby on Rails, Javascript and other</p>
        </div>

      </div>

    </footer>

  </body>
</html>
