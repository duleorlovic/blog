<!DOCTYPE html>
<html>

  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Oauth Specification Doorkeeper</title>
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="I am writing here some toughts during my work in Ruby on Rails, Javascript and other">
      <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/assets/css/main.css">
      <link rel="stylesheet" href="/assets/css/toc.css">

  </head>

  <body>

    <header class="site-header">

      <div class="wrap">

        <a class="site-title" href="/">duleorlovic - web developer</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
               viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
              <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
                h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
                h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
                c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </a>
          <div class="trigger">
            
              <a class="page-link" href="/about/">About</a>
            
              
            
              
            
              
            
          </div>
        </nav>
        <small>tools like
          <a href=" 
            /2015/04/05/common-rails-bootstrap-snippets/"
            >Rails bootstrap</a>,
          <a href=" /2015/11/09/rails-testing/">Rails testing</a>
            and <a href=" 
            /2016/04/12/rails-tips/">Rails tips</a>
          are still in use so content can be updated!
          <a href="javascript:void(0)"
            onclick="document.getElementById('mc_embed_signup').classList.toggle('active');">Notify
          me</a>
        </small>
	  <!-- Begin MailChimp Signup Form -->
	  <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
	  <style type="text/css">
		  #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
		  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
		     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
	  </style>
	  <div id="mc_embed_signup" class="signup-form">
	    <form action="//trk.us14.list-manage.com/subscribe/post?u=819590ae53cb08bddb952ed97&amp;id=ec1213024d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
		<div id="mc_embed_signup_scroll">
	    <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
	    <div class="mc-field-group">
		    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
	    </label>
		    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	    </div>
		    <div id="mce-responses" class="clear">
			    <div class="response" id="mce-error-response" style="display:none"></div>
			    <div class="response" id="mce-success-response" style="display:none"></div>
		    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
		<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_819590ae53cb08bddb952ed97_ec1213024d" tabindex="-1" value=""></div>
		<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
		</div>
	    </form>
	  </div>
	  <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
	  <!--End mc_embed_signup-->

      </div>
    <!-- Html Elements for Search -->
    <div id="search-demo-container">
    <input type="text" id="search-input" placeholder="search...">
    <ul id="results-container"></ul>
    </div>

    <!-- Script pointing to jekyll-search.js -->
    <script src="/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>
    <script>
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('results-container'),
        json: '/search.json',
      });
    </script>

    </header>
    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Oauth Specification Doorkeeper</h1>
    <p class="meta">Aug 13, 2018</p>
  </header>

  <article class="post-content">
  <body><div id="toc-container"><table class="toc" id="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div><ul><li class="toc_level-1 toc_section-1"><a href="#oauth-specification"><span class="tocnumber">1</span> <span class="toctext">Oauth specification</span></a><ul><li class="toc_level-2 toc_section-2"><a href="#2-client-registration"><span class="tocnumber">1.1</span> <span class="toctext">2. Client Registration</span></a></li><li class="toc_level-2 toc_section-3"><a href="#3-protocol-endpoints"><span class="tocnumber">1.2</span> <span class="toctext">3. Protocol Endpoints</span></a></li><li class="toc_level-2 toc_section-4"><a href="#4-obtaining-authorization"><span class="tocnumber">1.3</span> <span class="toctext">4. Obtaining authorization</span></a></li><li class="toc_level-2 toc_section-5"><a href="#10-client-authentication"><span class="tocnumber">1.4</span> <span class="toctext">10. Client Authentication</span></a></li><li class="toc_level-2 toc_section-6"><a href="#rails-oauth-provider-doorkeeper"><span class="tocnumber">1.5</span> <span class="toctext">Rails oauth provider doorkeeper</span></a></li></ul></li></ul></td></tr></tbody></table></div><h1 id="oauth-specification">Oauth specification</h1>

<p><a href="https://tools.ietf.org/html/rfc6749">https://tools.ietf.org/html/rfc6749</a> around 66 pages</p>

<blockquote>
  <p>Instead of using the resource owner’s credentials to access protected
resources, the client obtains an access token – a string denoting a specific
scope, lifetime, and other access attributes. Access tokens are issued to
third-party clients by an authorization server with the approval of the
resource owner.</p>
</blockquote>

<p>Roles:</p>
<ul>
  <li>resource owner (end-user) capable of granting access to protected resource</li>
  <li>client (web or server app) application that make protected resource requests</li>
  <li>resource server: capable of responding to requests using access token
on behalf of the resource owner and with its authorization</li>
  <li>authorization server: server issuing access tokens after successfully
authenticating the resource owner, and obtaining authorization</li>
</ul>

<p>Flow:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> +--------+                               +---------------+
 |        |--(A)- Authorization Request -&gt;|   Resource    |
 |        |                               |     Owner     |
 |        |&lt;-(B)-- Authorization Grant ---|               |
 |        |                               +---------------+
 |        |
 |        |                               +---------------+
 |        |--(C)-- Authorization Grant --&gt;| Authorization |
 | Client |                               |     Server    |
 |        |&lt;-(D)----- Access Token -------|               |
 |        |                               +---------------+
 |        |
 |        |                               +---------------+
 |        |--(E)----- Access Token ------&gt;|    Resource   |
 |        |                               |     Server    |
 |        |&lt;-(F)--- Protected Resource ---|               |
 +--------+                               +---------------+
</code></pre></div></div>

<ul>
  <li>client gets authorization grant from resource owner</li>
  <li>than using that grant get access token</li>
  <li>and using that token get protected resource</li>
</ul>

<p>4 Authorization Grant types (and extensibility mechanism for additional types):</p>
<ul>
  <li>authorization code - grant is authorization code</li>
  <li>implicit - no grant, direct token</li>
  <li>resource owner password credentials - grant is password</li>
  <li>client credentials</li>
</ul>

<ol>
  <li>Authorization code is obtained by using authorization server as an
intermediary between the client and resource owner. Client directs resource
owner to authorization server using user agent (because this is direct,
resource owner credentials are never shared with a client) and than resource
owner is directed back to the client with <strong>authorization code</strong> (without
passing code to user agent).</li>
  <li>Implicit is simplified authorization code for clients in browser using
javascript. Instead of issuing authorization code, the client is issued an
<strong>access token</strong> directly. When issuing access token, authorization server
does not authenticate the client, only place where we can verify client is
Redirect URI used to deliver access token to client. Access token may be
exposed to resource owner or other application with access to the resource
owner user agent.</li>
  <li>Resource owner password credentials can be used as authorization grant to
obtain access token. The credentials should be used only when there is high
degree of trust between resource owner and client (for example client is part
of device operating system). Usually client do not store credentials but use
them in single request to exchange with long-lived access token or refresh
token. Password flow is also used when your app owns oauth provider, since
user is sending username and password to get token.</li>
  <li>Client credentials is used when scope is limited to client protected
resources (not end user).</li>
</ol>

<p>Refresh tokens are used to obtain access tokens. It is optional and included
when issuing access token. It is used only with authorization server and never
sent to resource server. When access token expires client use refresh token to
get new access token (and eventual new refresh token). If client know expiration
date, it can request new access token before that moment.</p>

<h2 id="2-client-registration">2. Client Registration</h2>

<p>When registering the client, client developer SHALL specify client type,
redirection URI and other info like application name, logo, terms.
Client type is <em>confidential</em> when client is capable of maintaining the
confidentiality of their credentials (it runs on secure server like rails and
can secure client authentication).
Client type is <em>public</em> when client is incapable of maintaining the
confidentiality (it runs as native application on resource owner device, web
browser application or can not secure client authentication). For native
application is it assumed that client authentication credentials included in
application can be extracted, but dynamicaly issued access tokens can receive
acceptable level of protection.</p>

<p>Authorization server issues the registered client a client identifier, unique
identifier representing information provided by the developer. It is not a
secret and it exposed to resource owner and MUST NOT be used alone for client
authentication.</p>

<p>If client is confidential, than authorization server MAY accept any form of
client authentication (password, public/private key pair). If client is public
than authorization server MUST NOT rely on public client authentication for the
purpose of identifying the client.</p>

<p>Client password can be used with HTTP Basic authentication scheme (Digest of
identifier and password). Alternatively, authorization server MAY support client
credentials in request body (MUST NOT in request URI) like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&amp;refresh_token=tGzv3JOkF0XG5Qx2TlKWIA
&amp;client_id=s6BhdRkqt3&amp;client_secret=7Fjfp0ZBr1KtDRbnfVdmIw
</code></pre></div></div>

<h2 id="3-protocol-endpoints">3. Protocol Endpoints</h2>

<p>Two authorization server endpoints:</p>

<ul>
  <li>
    <p>authorization endpoint GET - used by client to obtain authorization grant from
resource owner via user agent redirection. Client get the location from service
documentation, Authorization server MUST verify identity of resource owner
(username/password, cookies…). It is used for Authorization code and implicit
which is defined in parameter: <code class="highlighter-rouge">response_type</code> REQUIRED <code class="highlighter-rouge">code</code> or <code class="highlighter-rouge">token</code>.
Redirection endpoint is MUST for public clients and confidentail clients
unilizing implicit grant type. Authorization server MAY allow client to register
multiple redirection endpoints. In that case, endpoint MUST be included in
<code class="highlighter-rouge">redirect_url</code> request parameter.</p>
  </li>
  <li>
    <p>token endpoint POST - used by client to exchange authorization grant to access
token. Used in every grant except implicit grant type (since access token is
issued directly).</p>
  </li>
</ul>

<p>One client endpoint:</p>

<ul>
  <li>redirection endpoint - used by authorization server to return responses
containing authorization credentials to the client via resource owner user
agent. For native apps it can be <code class="highlighter-rouge">my_app://redirect</code> for others, it MUST be
using TLS security ie begins with https</li>
</ul>

<p>Access token scope can be added as request parameter, as list of space delimited
case sensitive strings.</p>

<p>Client Authentication is MUST for token endpoint for confidential clients or
other clients issued client credentials. It is used to enforce bindings of
refresh token to client, recovering from compromised client by changing its
credentials.</p>

<h2 id="4-obtaining-authorization">4. Obtaining authorization</h2>

<h3 id="41-authorization-code">4.1 Authorization code</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  +----------+
   | Resource |
   |   Owner  |
   |          |
   +----------+
        ^
        |
       (B)
   +----|-----+          Client Identifier      +---------------+
   |         -+----(A)-- &amp; Redirection URI ----&gt;|               |
   |  User-   |                                 | Authorization |
   |  Agent  -+----(B)-- User authenticates ---&gt;|     Server    |
   |          |                                 |               |
   |         -+----(C)-- Authorization Code ---&lt;|               |
   +-|----|---+                                 +---------------+
     |    |                                         ^      v
    (A)  (C)                                        |      |
     |    |                                         |      |
     ^    v                                         |      |
   +---------+                                      |      |
   |         |&gt;---(D)-- Authorization Code ---------'      |
   |  Client |          &amp; Redirection URI                  |
   |         |                                             |
   |         |&lt;---(E)----- Access Token -------------------'
   +---------+       (w/ Optional Refresh Token)
</code></pre></div></div>

<p>Authorication code grant is used to obtain both access token and refresh tokens
and is optimized for confidential clients. Since this is redirection based flow,
client must be capable of interacting with resource owner user agent and capable
of receiving incoming requests from authorization server.
URI example:</p>

<ul>
  <li>response_type: required, must be <code class="highlighter-rouge">code</code></li>
  <li>client_id: required, client id when you created application on oauth server</li>
  <li>redirect_uri: required, where to redirect after authorization is complete</li>
  <li>scope=photos - one or more scope values indicating which part of account you
wish to access</li>
  <li>state: recommended to prevent cross-site request forgery csrf, random string
which you will verify later.</li>
</ul>

<p>Create “Log In” link with href <code class="highlighter-rouge">https://server.example.com/authorize?res...</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz
        &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
Host: server.example.com
</code></pre></div></div>

<p>Authorization response in case of resource owner grants access request</p>

<ul>
  <li>code: required, lifetime of 10minutes</li>
  <li>state: required if state was in requests</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA
         &amp;state=xyz
</code></pre></div></div>

<p>Response in case of missing, invalid redirection url or client_id, authorization
server MUST NOT automatically redirect to invalid redirection URI, but SHOULD
inform resource owner of the error.
Response in case of denies, authorization server by adding following parameter
to the redirection URI</p>

<ul>
  <li>error: required <code class="highlighter-rouge">invalid_request</code>, <code class="highlighter-rouge">unauthorized_client</code>, <code class="highlighter-rouge">access_denied</code> …</li>
  <li>error_description: optional</li>
  <li>state: required if state was in requests</li>
</ul>

<p>Access token request POST</p>

<ul>
  <li>grant_type: required <code class="highlighter-rouge">authorization_code</code></li>
  <li>code: required, authorization code from previous step</li>
  <li>redirect_uri: required if it was inclded in previous request</li>
  <li>client_id: required</li>
</ul>

<p>Client MUST authenticate with authorization server if client type is confidental
or client was issued client credentials</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
</code></pre></div></div>

<p>Access token response</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
 "access_token":"2YotnFZFEjr1zCsicMWpAA",
 "token_type":"example",
 "expires_in":3600,
 "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA",
 "example_parameter":"example_value"
}
</code></pre></div></div>

<h3 id="42-implicit-grant">4.2 Implicit Grant</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   +----------+
   | Resource |
   |  Owner   |
   |          |
   +----------+
        ^
        |
       (B)
   +----|-----+          Client Identifier     +---------------+
   |         -+----(A)-- &amp; Redirection URI ---&gt;|               |
   |  User-   |                                | Authorization |
   |  Agent  -|----(B)-- User authenticates --&gt;|     Server    |
   |          |                                |               |
   |          |&lt;---(C)--- Redirection URI ----&lt;|               |
   |          |          with Access Token     +---------------+
   |          |            in Fragment
   |          |                                +---------------+
   |          |----(D)--- Redirection URI ----&gt;|   Web-Hosted  |
   |          |          without Fragment      |     Client    |
   |          |                                |    Resource   |
   |     (F)  |&lt;---(E)------- Script ---------&lt;|               |
   |          |                                +---------------+
   +-|--------+
     |    |
    (A)  (G) Access Token
     |    |
     ^    v
   +---------+
   |         |
   |  Client |
   |         |
   +---------+
</code></pre></div></div>

<p>Optimized for public clients known to operate a particular redirection URI (it
does not support refresh tokens).
It is the same as authorization code but not sending secret, so we might use
<code class="highlighter-rouge">code</code>.</p>

<p>Request:</p>

<ul>
  <li>response_type: required <code class="highlighter-rouge">token</code></li>
  <li>client_id: required</li>
  <li>redirect_uri: optional</li>
  <li>scope: optional</li>
  <li>state: recommended</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /authorize?response_type=token&amp;client_id=s6BhdRkqt3&amp;state=xyz
    &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
Host: server.example.com
</code></pre></div></div>

<p>Authorization server MUST verify redirection URI matches registered uris.</p>

<p>Response:</p>

<ul>
  <li>access_token: required</li>
  <li>token_type: required <code class="highlighter-rouge">bearer</code>, <code class="highlighter-rouge">mac</code> <a href="https://tools.ietf.org/html/rfc6749#section-7.1">Access token types</a></li>
  <li>expires_in: recommended</li>
  <li>scope: optional if identical to requested scope, otherwise required</li>
  <li>state: required if state was in requests</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 302 Found
Location: http://example.com/cb#access_token=2YotnFZFEjr1zCsicMWpAA
         &amp;state=xyz&amp;token_type=example&amp;expires_in=3600
</code></pre></div></div>

<h3 id="43-resource-owner-password-credentials-grant">4.3 Resource Owner Password Credentials Grant</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   +----------+
   | Resource |
   |  Owner   |
   |          |
   +----------+
        v
        |    Resource Owner
       (A) Password Credentials
        |
        v
   +---------+                                  +---------------+
   |         |&gt;--(B)---- Resource Owner -------&gt;|               |
   |         |         Password Credentials     | Authorization |
   | Client  |                                  |     Server    |
   |         |&lt;--(C)---- Access Token ---------&lt;|               |
   |         |    (w/ Optional Refresh Token)   |               |
   +---------+                                  +---------------+
</code></pre></div></div>

<p>Request:</p>
<ul>
  <li>grant_type: required <code class="highlighter-rouge">password</code></li>
  <li>username: required</li>
  <li>password: required</li>
  <li>scope: optional</li>
</ul>

<p>We might send also client_id.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
Content-Type: application/x-www-form-urlencoded

grant_type=password&amp;username=johndoe&amp;password=A3ddj3w
</code></pre></div></div>

<p>Response</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
 "access_token":"2YotnFZFEjr1zCsicMWpAA",
 "token_type":"example",
 "expires_in":3600,
 "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA",
 "example_parameter":"example_value"
}
</code></pre></div></div>

<h3 id="44-client-credentials-grant">4.4 Client Credentials Grant</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   +---------+                                  +---------------+
   |         |                                  |               |
   |         |&gt;--(A)- Client Authentication ---&gt;| Authorization |
   | Client  |                                  |     Server    |
   |         |&lt;--(B)---- Access Token ---------&lt;|               |
   |         |                                  |               |
   +---------+                                  +---------------+
</code></pre></div></div>

<p>Client credentials grant type MUST only be used by confidential clients.
Authorization server MUST authenticate the client.
client_credentials is usually for apps (not for users) to update their info
(like icon, statistics…) outside of the context of any user.
But it can be used for apps than do not require user interaction, for example
payment gateway and when customer wants to pay, client do not need to ask user
if that is OK.</p>

<p>Request:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
 "access_token":"2YotnFZFEjr1zCsicMWpAA",
 "token_type":"example",
 "expires_in":3600,
 "example_parameter":"example_value"
}
</code></pre></div></div>

<h2 id="10-client-authentication">10. Client Authentication</h2>

<p>Web application clients MUST ensure confidentiality of client password.
The authorization server MUST NOT issue client passwords or other client
credentials to native application or user-agent-based application clients for
the purpose of client authentication.</p>

<p>The authorization server MAY issue a client password or other credentials for a
specific installation of a native application client on a specific device.</p>

<p><a href="https://tools.ietf.org/html/rfc6750">Access Token Specification</a>
Access token can have different formats. But it is abstraction layer so resource
server does not need to understand wide range of authentication methods.</p>

<h2 id="rails-oauth-provider-doorkeeper">Rails oauth provider doorkeeper</h2>

<p><a href="https://github.com/doorkeeper-gem/doorkeeper">doorkeeper</a> is rails engine that
provides oauth 2 auth <a href="http://railscasts.com/episodes/353-oauth-with-doorkeeper">railscasts #353</a>
Some intro how google does oauth2
https://developers.google.com/identity/protocols/OAuth2?csw=1</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;&gt; Gemfile &lt;&lt;HERE_DOC
# oauth provider
gem 'doorkeeper', '~&gt; 4.2.6'
HERE_DOC
rails g doorkeeper:install
rails g doorkeeper:migration
# add_foreign_key :oauth_access_grants, :users, column: :resource_owner_id
# add_foreign_key :oauth_access_tokens, :users, column: :resource_owner_id
git add . &amp;&amp; git commit -am "rails g doorkeeper:install"
</code></pre></div></div>

<p>Migration will generate three tables:</p>

<ul>
  <li>oauth_applications - store secret and redirect_uri</li>
  <li>oauth_access_grants - tokens for each user and application</li>
  <li>oauth_access_tokens - token, refresh_token</li>
</ul>

<p>When you list all generated routes you will notice three:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails routes -g oauth
# /oauth/authorize
# /oauth/applications - CRUD for applications
# /oauth/authorized_applications
# /oauth/token
# /oauth/token/info
# /oauth/revoke
</code></pre></div></div>

<p>First you need to set up one oauth application on
<a href="http://localhost:3004/oauth/applications">http://localhost:3004/oauth/applications</a> to generate <code class="highlighter-rouge">client_id</code> and
<code class="highlighter-rouge">client_secret</code>.</p>

<p>There are 4 ways to use <a href="https://aaronparecki.com/oauth-2-simplified">oauth grant types</a>:</p>
<ul>
  <li>authorization_code: web server, browser based and mobile apps</li>
  <li>imlicit: superceded by authorization code with no secret</li>
  <li>password</li>
  <li>client_credentials</li>
</ul>

<p>When you get access token, than you can authenticated request using header:
In doorkeeper by default access_token expires after 2 hours.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -H "Authorization: Bearer RsT5OjbzRn430zqMLgV3Ia" https://api.oauth2server.com/1/me
</code></pre></div></div>

<p><a href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Using-Scopes">Using scopes</a></p>

<p>Some provider opensource examples:
<a href="https://github.com/doorkeeper-gem/doorkeeper/wiki/Example-Applications">https://github.com/doorkeeper-gem/doorkeeper/wiki/Example-Applications</a></p>

<p>To test provider you can use <a href="https://github.com/intridea/oauth2">oauth2 client</a>
to generate <code class="highlighter-rouge">access_token</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install oauth2
irb -r oauth2
client_id = ''
client_secret = ''
redirect_uri = ''
client = OAuth2::Client.new(client_id, client_secret, site: 'https://localhost:3000')

client.auth_code.authorize_url redirect_uri: redirect_url
</code></pre></div></div>

</body>
  </article>

  
  
  
  
    
  
  
  
  
  
  
  
  

</div>

      </div>
    </div>

    <style type='text/css'>
      .similar-links {
        display: inline-block;
        padding: 10px;
      }
    </style>
    <footer class="site-footer">

      <div class="wrap">

        <h2 class="footer-heading">duleorlovic - web developer</h2>

        <div class="footer-col-1 column">
          <ul>
            <li><a href="http://duleorlovic.github.io/tips/">short indistinct tips</a></li>
          </ul>
        </div>

        <div class="footer-col-2 column">
          <ul>
            <li>
              <a href="https://github.com/duleorlovic">
                <span class="icon github">
                  <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                    <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                    c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                    c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                    c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                    C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                    c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                    c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                    c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                    c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                  </svg>
                </span>
                <span class="username">duleorlovic</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="footer-col-3 column">
          <p class="text">I am writing here some toughts during my work in Ruby on Rails, Javascript and other</p>
        </div>

      </div>

    </footer>

  </body>
</html>
