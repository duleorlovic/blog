---
layout: post
title: Vim
---

# My Vimrc

Good starting poing for **.vimrc** is  <http://vim.wikia.com/wiki/Example_vimrc>
You can find my [.vimrc](https://github.com/duleorlovic/config/blob/master/.vimrc)

Note that control key can be written as caret `^` so instead `Ctrl + n` it can
be written as `^n`.

Use vim help, with:

* `:help`
* `:helpgrep windows`
* `:help ^i` what Ctrl + i do in normal mode
* `:help i_^i` what ctrl+i do in insert mode
* `:help c_^i` what ctrl+i do in command mode

Command line mode `:help usr_20.txt` is when using `:` or search `/`,`?`.

* You can press `<Enter>` anywhere inside line
* Navigation with cursors `<Left>`, `<S-Left>` (one word left) and
`CTRL+B`/`CTRL+E` begin/end of line (only difference with bash is that `CTRL+B`
is char left and `CTRL+F` enters *Replace mode* in comand line window)
* Delete with `<BS>` or `CTRL-W` delete whole word, `CTRL+U` delete all before
text

* tab completetion works and you can see all matches with `CTRL-D` (match is
when command starts or short name starts with that)
* command line history can be used when you type start of command and `:se<UP>`
`CTRL-P` ignore what is already typed.

* Command line window `q:` or `CTRL-F` is used to edit long commands. `<CR>` to
execute comand end exit. Exit with `:q` or `CTRL-C`.

You can join multiple commands with `|` or `<NR>` (more help with
`cmdline-lines`)

Update to vim 8 use

~~~
sudo add-apt-repository ppa:jonathonf/vim
sudo apt-get update
sudo apt-get install vim
~~~

# Plugins

Install [pathogen](https://github.com/tpope/vim-pathogen) and other interesting plugins:

~~~
mkdir -p ~/.vim/autoload ~/.vim/bundle && \
curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim

cd ~/.vim/bundle
git clone git://github.com/tpope/vim-rails.git # example: Rview
~~~


You can find [my list of
plugins](https://github.com/duleorlovic/config/blob/master/vim/update_vim_bundle.sh#L8)

* rails-vim is nice
  * if you want to use rspec instead of minitest, you need to remove `tests`
  folder so `:Espec` works
  * run `<leader>s` to run nearest spec (also `t,l,a` for file, last and all
  specs)

Some not used anymore

* You complete me: its too much visualisation

  ~~~
  # http://vimawesome.com/plugin/vim-rspec-sad-beautiful-tragic # :RunSpec
  git clone git@github.com:Valloric/YouCompleteMe.git && cd YouCompleteMe && ./install.sh && cd -
  ~~~

* [vim-markdown](https://github.com/plasticboy/vim-markdown): issue with syntax
highlight for * inside code block

* [vim-autoclose](https://github.com/Townk/vim-autoclose): annoying O char
waiting next input


# Running ruby in vim and show in separate window

[link](http://vim.wikia.com/wiki/Preview_output_from_interpreter_in_new_window)
Press `F7` to run selected or all code. Shift + F7 close the window.

~~~
"save code, run ruby, show output in preview window
function! Ruby_eval_vsplit() range
  let src = tempname()
  let dst = tempname()
  execute ": " . a:firstline . "," . a:lastline . "w " . src
  execute ":silent ! ruby " . src . " > " . dst . " 2>&1 "
  execute ":pclose!"
  execute ":redraw!"
  execute ":vsplit"
  execute "normal \<C-W>l"
  execute ":e! " . dst
  execute ":set pvw"
  execute "normal \<C-W>h"
endfunction
vmap <silent> <F7> :call Ruby_eval_vsplit()<CR>
nmap <silent> <F7> mzggVG<F7>`z
imap <silent> <F7> <Esc><F7>a
map <silent> <S-F7> <C-W>l:bw<CR>
imap <silent> <S-F7> <Esc><S-F7>a
~~~

# Seeing is believing

Show ruby return values on each line in vim.
Install [seeing_is_believing](https://github.com/JoshCheek/seeing_is_believing)
with `gem install seeing_is_believing --version 3.0.0.beta.7` and add plugin `cd
~/.vim/bundle && git clone https://github.com/hwartig/vim-seeing-is-believing`
and add mappins: `F4` mark, `F5` run (not in visual) and `enter` mark and run
(not in insert mode)

~~~
" .vimrc Enable seeing-is-believing mappings only for Ruby
augroup seeingIsBelievingSettings
  autocmd!

  autocmd FileType ruby nmap <buffer> <Enter> <Plug>(seeing-is-believing-mark-and-run)
  autocmd FileType ruby xmap <buffer> <Enter> <Plug>(seeing-is-believing-mark-and-run)

  autocmd FileType ruby nmap <buffer> <F4> <Plug>(seeing-is-believing-mark)
  autocmd FileType ruby xmap <buffer> <F4> <Plug>(seeing-is-believing-mark)
  autocmd FileType ruby imap <buffer> <F4> <Plug>(seeing-is-believing-mark)

  autocmd FileType ruby nmap <buffer> <F5> <Plug>(seeing-is-believing-run)
  autocmd FileType ruby imap <buffer> <F5> <Plug>(seeing-is-believing-run)
augroup END
~~~

# Theory

* [quick reference card](http://tnerual.eriogerg.free.fr/vimqrc.html)
* [tutorial](http://www.viemu.com/a_vi_vim_graphical_cheat_sheet_tutorial.html)
* `nnoremap ,html :asd` first letter `n` means that this applies only in normal
  mode, `no remap` means do not reinvoke if those commands `,html` are used for
  something else, `map` means simply when I type `,html` please type `:asd`
* `normal!` (with bang) means execute this exactly as I write (`normal` will not
  ignore mappings that user could have written and destroy your commands)
* functions can be used to wrap some commands and give it a name.
  Use `function!` so you can overwrite it without error. Undo will undo whole
  function at once.

  ~~~
  function! MyFuction()
    normal! mmu`m
  endfunction
  nnoremap <leader>sp :call MyFuction()<cr>
  ~~~
* source current file `nnoremap <leader>sop :source %<cr>` is used to source
  .vimrc so you do not need to exit and start vim again. You can reload any
  `.vim` file, for example `:source ~/config/vim/syntastic.vim`
* conditionals

  ~~~
  function! MF(level)
    if a:level == 1
      normal! yy
    elseif a:level == 2
      " ....
    endif
  endfunction
  ~~~

# Movements

* `$` end of line, `0` start of line (or `^`)
* `+` and `-` move line up or down on the first letter
* `{` and `}` move on paragraph (empty line)
* `^B`(`^U`) or `^F` (`^D`) scroll up (half) or down (half) page
* `H` `M` `L` move to the top/middle/bottom of the window, so you can scroll
* `mA` then `'A` jump there (downcase letter `a` can jump only on current
buffer), `:marks` gives the jump location, two ' `''` is jump back, `'.` jump to
last change
* `^o` and `^i` will jump to previos and next location
* `%` jump closing brackets or other matching brace
* `5G` or `:5` goes to the line 5
* `gg` goes top, `G` goes bottom
* `g,` and `g;` jump to next/prev change on current buffer
* `:set scrollbind` in two buffers will make them scroll simultaneously. toggle
scrolling with `:set scb!`
* show line numbers `:set number` or relative numbers `:set relativenumber` (or
shorter `:set rnu`
* show approx position in text `^G`
* `gf` follow that file
* `^]` open ctag

# Motions and selections

* `ciw` change inner word, `caw` including spaces that follows the word
  * `ca]` change all inside brackets including both [ ]
* `daw` removes the inner word
* `dt ` delete until the space, `df ` delete until the space including space
* `dap}p` switch two paragraph
* `dE` removes to the End of the string
* recording macro to q with `qq`, exit with `q`, run with `@q`
* paste commands in insert mode with `^Rq`
* `^T` indent in insert mode

# Motion in visual mode

* `'<` to the first line (`\`<` char) of last selected visual area. Note that
you need to exit current visual area and than jump to first or last line/char
* `vit` inner or `vat` outer (including tag) visual select tag `:h tag-blocks`
  * repeat `at` to select wraped tag
  * jump with `o` more on `:help visual-operators` `:help v_it`
  * `vap` select paragraph (until next empty line, including that empty line)
  * `dst` delete surround tag with vim surround plugin
* `va'` visually select all inside ' including '
* `cgn` change visually selected text using previous search
* `gv` to select previous selected visual area

# Copy paste

* `"+y` copy visual selection to system clipboard, ubuntu should run `sudo
  apt-get install vim-gtk`. You can select which register to use with `"add`
  `"ap"`
* `%y+` copy all lines to clipboard
* to move a line to buffer on the left you can record macro (something like
`yy ^wh p ^wl`)
* to paste with proper indend use [vim-unimpaired](https://github.com/tpope/vim-unimpaired) `]p`


# Exploring

* `:edit .` (short `:e.`) opens (`:vsp`) splits netrw of folder,

## Netrw

[netrw.vim](https://github.com/duleorlovic/config/blob/master/vim/netrw.vim) is
native exprorer.
`:Explore`(short `:E`) `:Vex` of current editing file
To change current folder just press c on folder line `help :netrw-c`.
That's better than `cd ../path` which change in all tabs. It will not affect
already opened windows, so it should be done on the first window in the tab.

Inside netrw:

* `%` create new file, more info `:help netrw-%`
* `d` create new directory
* `R` rename file/directory under cursor
* `D` delete file/directory under cursor

## NERD tree

* to change current directory to selected folder, type in normal mode `cd`. It
will change directory only in current buffer.

# Searching

* `/` for searching, to search in oposite direction `?` (`n` and `N` for next
and previous result)
* `:grep subject -R * --exclude-dir={log,spec,public,features,tmp,vendor,assets,db} -I`
* grep end of the word `/usan\>` help with `:h /\>`
* `:%s/old/new/gc`
* `q:` shows history of commands
* `q/` shows history of searches
* `:argdo %s/foo/bar/ge | update`  replace in all arg
* `:set nowrapscan` is usefull when you want to stop search when you hit bottom
  of a file. With `gg` you can jump to begging. `:set wrapscan` when you want to
  back to wrapped search
* clear highlights until nex search `:noh`, to clear completely `set nohlsearch`
  or toggle `nnoremap <F3> :set hlsearch!<CR>`
* `vim my_string **/*.md | copen` search only md files for my_string and show
results
* beggining and end of line marks like `/^asd` and `/asd$` works fine (not in
the middle `/asd^qwe`. For multiline search you can use: `\n` new line, `\_s`
space,tab or newline, `\_.` any char including new line, `\_^` and `\_$` are
beggining and end of line. You can use minimum matcher `\{-}` to stop as soon as
possible (instead of `*` which will stop at last occurrence).
  * `/asd\_.\{-}qwe` find asd followed with any character (including new line)
  and stop at qwe. You can use [S and S!
  snippet](http://vim.wikia.com/wiki/Search_across_multiple_lines#Searching_over_multiple_lines_with_a_user_command)

# Windows buffers and tabs

[terminology](http://vim.wikia.com/wiki/Easier_buffer_switching)

* `:tabe file` open file in new tab, `gt` switch between tabs
* `:help Ctrl-W_T` move current buffer in new tab, Disable default Terminal ->
Preferences -> Shortcuts
* `gx` open link under cursor with `gnome-open`
* `:vsp #1`  vertically split window with file #1
* `:on` or `Ctrl+W+o` closes all windord except current
* `:buffers`, `:b1`, `:bun` closes the buffer
* `CTRL+^` (shift+6) jump to previous buffer
* `retab` this will actually reformat all source
* `ctrl+w+f` is the same as `gf` but opens in new vertical split window
* `b substring_of_filename` open buffer that matches substring (press tab in
  case of multiple mathces)

# Completion

* `^n` or `^p` in insert mode to autocomplete strings
* `^x^n` only strings from current file
* `^x^f` to complete filename (keep `^x^f` when you navigate subfolders)
* `^x^]` for tags find other shortcuts with `:help ins-completion`
* `^a` and `^x` to increment and decrement numbers
[speeddating](https://github.com/tpope/vim-speeddating) if you want to increment
dates
* for commands you can use `^d` to show all completion and `<tab>` to use it

# Usefull commands

* Repeat last colon command `@:`, repeat last command `@@`
* `:args app/*/*`  to add all files to arg list
* `:nnoremap _ f_x~` find next `_`, remove and uppercase
  [link](http://vim.wikia.com/wiki/Converting_variables_to_or_from_camel_case)
  for moving underscore to CamelCase
* `gq` in visual mode will format text to 80 char lines (good for markdown)
* using vim inside irb or rails console with gem
  [interactive_editor](https://github.com/jberkel/interactive_editor). Its
  usefull since you can paste only limited number of chars to irb line. Now you
  can write your input data in file/ruby code and insert byebug/debugger/pry in
  rails code, and start hunting for bugs
* `set showcmd` enable showing all keys that I'm typing in bottom right corner,
  very usefull when explaining to someone
* snippet `nnoremap ,html :-1read $HOME/.vim/.skeleton.html<CR>3jwf>a` [my
snippets](https://github.com/duleorlovic/config/tree/master/vim/snippets)

# Books, videos tutorials

* [vim theory]({{ site.baseurl }} {% post_url 2017-06-05-vim-theory %})
* <https://www.youtube.com/watch?v=5r6yzFEXajQ>
* [--noplugin](https://www.youtube.com/watch?v=XA2WjJbmmoM)

  ~~~
  # fuzzy finder
  set path+=**
  find *-vim #
  ~~~

  ~~~
  # ctags
  # need to generate tags file with `ctags -R .`
  # since I override Ctrl+] to be page up, run `pkill xbindkeys first`
  ^] # jump to tag under cursos
  g] # list all ambiguous tags: same method could be defined in multiple classes
  ^t # jump back in tags stack
  ^x^] # autocomplete tags
  ~~~


# Syntastic checker

[syntastic](https://github.com/scrooloose/syntastic) vim plugin is great to
write your code. Just need to install external syntac checkers and they will be
eabled. `SyntasticInfo` can give you current checkers and `help
syntastic-checkers` will show you all available checkers.

To check if some checker is installed you can try with system command (here we
show current path):

~~~
:echo syntastic#util#system('echo "$PATH"')
~~~

You need to activate checkers for specific **filetype** and you can customise
speific **checker**

~~~
let g:syntastic_<filetype>_checkers = ['<checker-name>']
let g:syntastic_<filetype>_<checker>_args = "--my --args --here"
~~~

You can jump to next error or warning with `:lnext` or `:lpr` or using
[vim-unimpaired](https://github.com/tpope/vim-unimpaired) `[l` `]l` (other
shortcuts are `]b` (buffers) `]q` (search). To close error window you need to
`:lcl`. Find all commands `:help unimpaired`

Here is my configuration for syntastic and vim
<https://github.com/duleorlovic/config/blob/master/vim/syntastic.vim>
You need to install this tools:

* Markdown `gem install mdl`
* Ruby, Rails `gem install rubocop`. To define quiet messges you can write in
  * [.rubocop.yml](https://github.com/duleorlovic/config/blob/master/.rubocop.yml)
    in $HOME or project root. To disable all write `.rubocop.yml`:

  ~~~
  AllCops:
    Exclude:
      - '**/*'
  ~~~

  * inline in comment `# rubocop:disable Metrics/AbcSize,
    Metrics/MethodLength`
  * define in `syntastic.vim`
    [g:syntastic_eruby_ruby_quiet_message](https://github.com/duleorlovic/config/blob/master/vim/syntastic.vim#L21)
  * fix `possibly useless use of a constant in void context` in erb is with
  `<%= CONST.to_s %>`, when is problem with + than fix with assign `<%= total =
  a + b; total %>`

* Javascript `npm install -g jscs jscs-angular` and create files [.jscs](
* json `npm install -g jsonlint` [link to issue](https://github.com/jaxbot/syntastic-react/issues/4)

  ~~~
  " .vimrc
  au BufRead,BufNewFile *.json set filetype=json
  let g:syntastic_json_checkers=['jsonlint']
  ~~~
* coffeescript `npm install -g coffeelint`

# Vimium

Normal mode:

* `j` and `k` down and up on a page
* `f` follow links `F` follow in new tab
* `H` and `L` back and forward in history
* `J` and `K` prev and next tab
* `o` search and open history links
* `T` search open tabs
* `r` reload the page

Find mode, enter with `/`:

* `n` and `N` next and prev search match

Insert mode, enter with `i`. So if you notice that `x` closes tab even you are
inside input, jump into insert mode first...

Since gmail has own `j` `k` prev and next email, I added rule to ignore all
(`*`) keys

# Vimum VimFx

[VimFx](https://addons.mozilla.org/ru/firefox/addon/vimfx/)
[source](https://github.com/akhodakivskiy/VimFx) is vimium for
firefox. `f` for navigation and clicks, `/` for search (n N), `x` `X` for close
and reopen tab, `J` `K` switch, `space` `shift+space` page down up.
[Hints
mode](https://github.com/akhodakivskiy/VimFx/blob/master/documentation/commands.md):
* `f` anything clicable `F` opens in new tab (or press Ctrl) `ew` new window
* by default lowercase letter will filter hint strings, but you can use
uppercase letter to filter by text (you can see what is entered in lower right
corner)
* `yf` copy text and links

# Rails vim

Some todos:

## Pluralize

When I type `:Rcontroller customer` it should go to `:Rcontroller customers`
instead of error: `No such controller customer`. This usually happens when I
have a lot of models `customer_invoices`, `customer_payments` and `customers`.

## Localize

When I'm in `index.html.erb` and I type `:Rcontroller` than I jump to
controller, but if I'm on `index.in.html.erb` than there is an error `Argument
required`. Also problem with `:Eview another_`

# My plugin: Show dedented lines

When looking at large files in small window (I have 4 vim windows in my single
terminal window) than I want to see to which block current line belongs.

~~~
ActiveRecord::Schema.define(version: 20170124131420) do
  create_table "projects", force: :cascade do |t|
    ... long ...
    t,integer title
~~~

When I'm in long spec file, I want to see setup block for current example and
all outer example groups (maybe to group all descriptions in one sentence).

~~~
RSpec.describe Project do
 let(:project) { Project.new }
 before
 ... long ...
 describe "create task" do
   ... long ...
   it "order by date" do
     project
~~~

Also in view, I want to be able where current element belongs, so list all
wrapped elements. And when I'm in scss I want to see all parent selector,
classes and media queries.

# Graph visualization in markdown

<https://markvis-editor.js.org/>
